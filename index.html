<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Crunch.io API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["http","shell","python","r"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="http">HTTP</a>
              <a href="#" data-language-name="shell">cURL</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="r">R</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://crunch.io/'>Sign Up</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Crunch exposes a REST API for third parties, and indeed its own UI, to manage datasets. This API is also used by the <a href="https://github.com/Crunch-io/pycrunch">Python</a> and <a href="https://github.com/Crunch-io/rcrunch">R</a> libraries. This User Guide is for developers who are writing applications on top of the Crunch REST API, with or without those language bindings. It describes the existing interfaces for the current version and attempts to provide context and examples to guide development. </p>

<p>The documents are organized in three overlapping scopes: a <a href="#feature-guide">feature guide</a>, which provide higher-level vignettes that illustrate key features; an <a href="#endpoint-reference">endpoint reference</a>, which describes individual URIs in detail; and an <a href="#object-reference">object reference</a>, which defines the building blocks of the Crunch platform, such as values, columns, types, variables, and datasets.</p>

<h1 id="feature-guide">Feature Guide</h1>

          <h2 id="authentication">Authentication</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/public/login/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">67</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake.user@example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">token=dac20c82c79a514d572b4f5d7e11cb53; Domain=.crunch.io; Max-Age=31536000; Path=/</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Cookie, Accept-Encoding</span>

</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">(</span><span class="s2">"fake.user@example.com"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">)</span>
<span class="c1"># See ?login for options, including how to store your credentials 
# in your .Rprofile
</span></code></pre>
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">pycrunch</span>
</code></pre>
<pre class="highlight shell"><code>curl -c cookie-jar 
    -X POST 
    -d <span class="s1">'{"email": "fake.user@example.com", "password": "password"}'</span> 
    -H <span class="s2">"Content-type: application/json"</span>
    https://beta.crunch.io/api/public/login/

<span class="c"># The above command will perform a login and save the login cookie to a file called 'cookie-jar'.</span>
<span class="c"># After this, you can access the endpoint via `curl' commands (POST, GET, PATCH), as long as the '-b cookie-jar' flag is present.  Note, -b not -c.  -c saves cookies, -b submits cookies from the existing file. It is good practice to delete this file when you are done.</span>
</code></pre>

<blockquote>
<p>Replace &ldquo;fake.user@example.com&rdquo; and &ldquo;password&rdquo; with your email and password, respectively.</p>
</blockquote>

<p>Nearly all interactions with the Crunch API need to be authenticated. The standard password authentication method involves POSTing credentials and receiving a cookie back, which should be included in subsequent requests.</p>

<p>The client should then store the Cookie and pass it along with each subsequent request.</p>

<p>Failure will return 401 Unauthorized.</p>

<aside class="notice">
Replace &ldquo;fake.user@example.com&rdquo; and &ldquo;password&rdquo; with your email and password, respectively.
</aside>

<p>Crunch also supports OAuth 2.0/OpenID Connect. See <a href="#public">the public endpoint reference</a> for more on how to authenticate with OAuth. </p>

<p>If you&rsquo;d like to add your auth provider to the set of supported providers, contact <a href="mailto:support@crunch.io">support@crunch.io</a></p>

          <h2 id="importing-data">Importing Data</h2>

<p>There are several ways to build a Crunch dataset. The most appropriate method for you to create a dataset depends primarily on the format in which the data is currently stored.</p>

<h3 id="import-from-a-data-file">Import from a data file</h3>

<p>In some cases, you already have a file sitting on your computer which has source data, in a format like CSV or SPSS. You can upload these to Crunch and then attach them to datasets by following these steps.</p>

<h4 id="1-create-a-dataset-entity">1. Create a Dataset entity</h4>
<pre class="highlight http"><code><span class="err">
</span><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">newDatasetFromFile</span><span class="p">(</span><span class="s2">"my.csv"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"my survey"</span><span class="p">)</span>
<span class="c1"># All three steps are handled within newDatasetFromFile
</span></code></pre>

<p>POST a Dataset Entity to the datasets catalog.</p>

<h4 id="2-upload-the-file">2. Upload the file</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/sources/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/csv</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">8874357</span>
<span class="na">Content-Disposition</span><span class="p">:</span> <span class="s">form-data; name="uploaded_file"; filename="my.csv"</span>
<span class="s">...</span>
<span class="s">"case_id","q1","q2"</span>
<span class="s">234375,3,"sometimes"</span>
<span class="s">234376,2,"always"</span>
<span class="s">...</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/sources/{source_id}/</span>
</code></pre>

<p>POST the file to the sources catalog. </p>

<h4 id="3-add-the-source-to-the-dataset">3. Add the Source to the Dataset</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "body": {</span>
<span class="s">        "source": "/sources/{source_id}/"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
</code></pre>

<p>POST the URL of the just-created source entity (the Location in the 201 response from the previous step) to the batches catalog of the dataset entity created in step 1. </p>

<aside class="notice">If your file is large, you may wish to have this import job be completed asynchronously in order to avoid hitting a server timeout. To do so, include `&ldquo;async&rdquo;: true` in the &ldquo;body&rdquo; key of the payload. This will change the response status from 201 to 202, and you&rsquo;ll need to poll the server to learn when the import job has been completed. See batches for details.</aside>

<h3 id="metadata-document-csv">Metadata document + CSV</h3>

<p>This approach may be most natural for importing data from databases that store data by rows. You can dump or export your database to Crunch&rsquo;s JSON metadata format, plus a CSV of data, and upload those to Crunch, without requiring much back-and-forth with the API.</p>

<h4 id="1-create-a-dataset-entity-with-variable-definitions">1. Create a Dataset entity with variable definitions</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...,</span>
<span class="s">        "table": {</span>
<span class="s">            "element": "crunch:table",</span>
<span class="s">            "metadata": {</span>
<span class="s">                "educ": {"name": "Education", "alias": "educ", "type": "categorical", "categories": [...], ...},</span>
<span class="s">                "color": {"name": "Favorite color", "alias": "color", "type": "text", ...}</span>
<span class="s">            },</span>
<span class="s">            "order": [{"group": "my group", "entities": ["educ", ...]}, ...]</span>
<span class="s">        },</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>

<p>POST a Dataset Entity to the datasets catalog, and in the &ldquo;body&rdquo;, include a Crunch Table object with variable definitions and order.</p>

<p>The &ldquo;metadata&rdquo; member in the table is an object containing all variable definitions, keyed by variable alias. See the Object Reference: Variable Definitions discussion for specific requirements for defining variables of various types, as well as the example below.</p>

<p>The &ldquo;order&rdquo; member is a Shoji Order object specifying the order, potentially hierarchically nested, of the variables in the dataset. The example below illustrates how this can be used. Shoji is JSON, which means the &ldquo;metadata&rdquo; object is explicitly unordered. If you wish the variables to have an order, you must supply an order object rather than relying on any order of the &ldquo;metadata&rdquo; object.</p>

<h4 id="2-add-row-data">2. Add row data</h4>

<blockquote>
<p>By file:</p>
</blockquote>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/csv</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">8874357</span>
<span class="na">Content-Disposition</span><span class="p">:</span> <span class="s">form-data; name="file"; filename="thedata.csv"</span>
<span class="s">...</span>
<span class="s">"educ","color"</span>
<span class="s">3,"red"</span>
<span class="s">2,"yellow"</span>
<span class="s">...</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
</code></pre>

<blockquote>
<p>By S3 URL:</p>
</blockquote>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">341</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "url": "s3://bucket_name/dir/subdir/?accessKey=ASILC6CBA&amp;secretKey=KdJy7ZRK8fDIBQ&amp;token=AQoDYXdzECAa%3D%3D",</span>
<span class="s">        "async": false</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
</code></pre>

<p>POST a CSV file or URL to the new dataset&rsquo;s batches catalog. The CSV must include a header row of variable identifiers, which should be the aliases of the variables (and array subvariables) defined in step (1).</p>

<aside class="success">The CSV may be gzipped. In fact, you are encouraged to gzip it.</aside>

<p>The values in the CSV MUST be the same format as the values you get out of Crunch, and it must match the metadata specified in the previous step. This includes:</p>

<ul>
<li>Categorical variables should have data identified by the integer category ids, not strings, and all values must be defined in the &ldquo;categories&rdquo; metadata for each variable.</li>
<li>Datetimes must all be valid ISO 8601 strings</li>
<li>Numeric variables must have only (unquoted) numeric values</li>
<li>The only special value allowed is an empty &ldquo;cell&rdquo; in the CSV, which will be read as the system-missing value &ldquo;No Data&rdquo;</li>
</ul>

<p>Violation of any of these validation criteria will result in a 409 Conflict response status. To resolve, you can either (1) fix your CSV locally and re-POST it, or (2) PATCH the variable metadata that is invalid and then re-POST the CSV.</p>

<p>Imports are done in &ldquo;strict&rdquo; mode by default. Strict imports are faster, and using strict mode will alert you if there is any mismatch between data and metadata. However, in some cases, it may be convenient to be more flexible and silently ignore or resolve inconsistencies. For example, you may have a large CSV dumped out of a database, and the data format isn&rsquo;t exactly Crunch&rsquo;s format, but it would be costly to read-munge-write the whole file for minor changes. In cases like this, you may append <code class="prettyprint">?strict=0</code> to the URL of the POST request to loosen that strictness.</p>

<p>With non-strict imports:</p>

<ul>
<li>The CSV may contain columns not described by the metadata; these columns will be ignored, rather than returning an error response</li>
<li>The metadata may describe variables not contained in the CSV; these variables will be filled with missing values, rather than returning an error response</li>
<li>And more things to come</li>
</ul>

<p>In either case, a 201 response to the POST request indicates success. All rows added in a single request become part of a new Batch, whose URL is returned in the response Location. You may inspect the new rows in isolation by following its batch/ link.</p>

<p>The CSV can be sent in one of two ways:</p>

<ol>
<li>Upload a file by POSTing a multipart form</li>
<li>POST a Shoji entity with a &ldquo;url&rdquo; in the body, containing all necessary auth keys as query parameters. If the URL points to a single file, it should be a CSV or gzipped CSV, as described above. If the URL points to a directory, the contents will be assumed to be (potentially zipped) batches of a CSV and will be concatenated for appending. In the latter case, only the first CSV in the directory listing should contain a header row. For large import jobs, you may set the (optional) &ldquo;async&rdquo; body parameter to &ldquo;true&rdquo;. In this case, the request will respond 202 Continue status, and work will proceed outside the request cycle. As described <a href="#3.-add-the-source-to-the-dataset">above</a>, poll the batch entity to learn when the import job has been completed or if an error occurred. See batches for details.</li>
</ol>

<h4 id="example">Example</h4>

<p>Here&rsquo;s an example <a href="examples/dataset.json">dataset metadata</a> and corresponding <a href="examples/dataset.csv">csv</a>.</p>

<p>Several things to note:</p>

<ul>
<li>Everything–metadata, order, and data–is keyed by variable &ldquo;alias&rdquo;, not &ldquo;name&rdquo;, because Crunch believes that names are for people, not computers, to understand. Aliases must be unique across the whole dataset, while variable &ldquo;names&rdquo; must only be unique within their group or array variable.</li>
<li>For categorical variables, all values in the CSV correspond to category ids, not category names, and also not &ldquo;numeric_values&rdquo;, which need not be unique or present for all categories in a variable.</li>
<li>The array variables defined in the metadata (&ldquo;allpets&rdquo; and &ldquo;petloc&rdquo;) don&rsquo;t themselves have columns in the CSV, but all of their &ldquo;subvariables&rdquo; do, keyed by their aliases. </li>
<li>With the exception of those array variable definitions, all variables and subvariables defined in the metadata have columns in the CSV, and there are no columns in the CSV that are not defined in the metadata.</li>
<li>For internal variables, such as a case identifier in this example, that you don&rsquo;t want to be visible in the UI, you can add them as &ldquo;hidden&rdquo; from the beginning by including <code class="prettyprint">&quot;discarded&quot;: &quot;true&quot;</code> in their definition, as in the example of &ldquo;caseid&rdquo;. </li>
<li>Missing values

<ul>
<li>Variables with categories (categorical, multiple_response, categorical_array) have missing values defined as categories with <code class="prettyprint">&quot;missing&quot;: &quot;true&quot;</code></li>
<li>Text, numeric, and datetime variables have missing variables defined as &ldquo;missing_rules&rdquo;, which can be &ldquo;value&rdquo;, &ldquo;set&rdquo;, or &ldquo;range&rdquo;. See, for example, &ldquo;q3&rdquo; and &ldquo;ndogs&rdquo;.</li>
<li>Empty cells in the CSV, if present, will automatically be translated as the &ldquo;No Data&rdquo; system missing value in Crunch. See, for example, &ldquo;ndogs_b&rdquo;.</li>
</ul></li>
<li>Order

<ul>
<li>All variables should be referenced by alias in the &ldquo;order&rdquo; object, inside a group&rsquo;s &ldquo;entities&rdquo; key. Any omitted variables (in this case, the hidden variable &ldquo;caseid&rdquo;) will automatically be added to a group named &ldquo;ungrouped&rdquo;.</li>
<li>Variables may appear in multiple groups.</li>
<li>Groups may be nested within each other.</li>
</ul></li>
</ul>

<h3 id="column-by-column">Column-by-column</h3>

<p>Crunch stores data by column internally, so if your data are stored in a column-major format as well, importing by column may be the most efficient way to import data.</p>

<h4 id="1-create-a-dataset-entity">1. Create a Dataset entity</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">createDataset</span><span class="p">(</span><span class="s2">"my suryey"</span><span class="p">)</span>
</code></pre>

<p>POST a Dataset Entity to the datasets catalog, just as in the first import method.</p>

<h4 id="2-add-variable-definitions-and-column-data">2. Add Variable definitions and column data</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">38475</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "Gender",</span>
<span class="s">        "alias": "gender",</span>
<span class="s">        "type": "categorical",</span>
<span class="s">        "categories": [</span>
<span class="s">            {</span>
<span class="s">                "name": "Male",</span>
<span class="s">                "id": 1,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": false</span>
<span class="s">            },</span>
<span class="s">            {</span>
<span class="s">                "name": "Female",</span>
<span class="s">                "id": 2,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": false</span>
<span class="s">            },</span>
<span class="s">            {</span>
<span class="s">                "name": "Skipped",</span>
<span class="s">                "id": 9,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": true</span>
<span class="s">            }</span>
<span class="s">        ],</span>
<span class="s">        "values": [1, 9, 1, 2, 2, 1, 1, 1, 1, 2, 9, 1]</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/variables/{variable_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="c1"># Here's a similar example. R's factor type becomes "categorical". 
</span><span class="n">gender.names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Male"</span><span class="p">,</span> <span class="s2">"Female"</span><span class="p">,</span> <span class="s2">"Skipped"</span><span class="p">)</span>
<span class="n">gen</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">gender.names</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">)],</span>
    <span class="n">levels</span><span class="o">=</span><span class="n">gender.names</span><span class="p">)</span>
<span class="c1"># Assigning an R vector into a dataset will create a variable entity.
</span><span class="n">ds</span><span class="o">$</span><span class="n">gender</span> <span class="o">&lt;-</span> <span class="n">gen</span>
</code></pre>

<p>POST a Variable Entity to the newly created dataset&rsquo;s variables catalog, and include with that Entity definition a &ldquo;values&rdquo; key that contains the column of data. Do this for all columns in your dataset. </p>

<aside class="notice">Note that the lengths of the columns of data you include in the &ldquo;values&rdquo; key must be the same for all variables, though if you&rsquo;re importing from a normal, rectangular data store, this should already be the case.</aside>

          <h2 id="appending-data">Appending Data</h2>

<p>Appending data to an existing Dataset is not much different from uploading the initial data; both use a &ldquo;Batch&rdquo; resource which represents the process of importing the data from the source into the dataset. Once you have created a Source for your data, POST its URL to datasets/{id}/batches/ to start the import process. That process may take some time, depending on the size of the dataset. The returned Location is the URI of the new Batch; GET the batches catalog and look up the Batch URI in the catalog&rsquo;s index and inspect its status attribute until it moves from &ldquo;analyzing&rdquo; to &ldquo;appended&rdquo;. User interfaces may choose here to show a progress meter or some other widget.</p>

<p>During the &ldquo;analyzing&rdquo; stage, the Crunch system imports the data into a temporary table, and matches its variables with any existing variables. During the &ldquo;importing&rdquo; stage, the new rows will move to the target Dataset, and once &ldquo;appended&rdquo;, the new rows will be included in all queries against that Dataset.</p>

<h3 id="adding-a-subsequent-source">Adding a subsequent Source</h3>

<p>Once you have created a Dataset, you can upload new files and append rows to the same Dataset as often as you like. If the structure of each file is the same as that of the first uploaded file, Crunch should automatically pass your new rows through exactly the same process as the old rows. If there are any derived variables in your Dataset, new data will be derived in the new rows following the same rules as the old data. You can follow the progress as above via the batch&rsquo;s status attribute.</p>

<p>Let&rsquo;s look at an example: you had uploaded an initial CSV of 3 columns, A, B and C. Then:</p>

<ul>
<li>The Crunch system automatically converted column A from the few strings that were found in it to a Categorical type.</li>
<li>You derived a new column D that consisted of B * C.</li>
</ul>

<p>Then you decide to upload another CSV of new rows. What will happen?</p>

<p>When you POST to create the second Batch, the service will: 1) match up the new A with the old A and cast the new strings to existing categories by name, and 2) fill column D for you with B * C for each new row.</p>

<p>However, from time to time, the new source has significant differences: a new variable, a renamed variable, and other changes. When you attach the first Source to a Dataset, there is nothing with which to conflict. But a subsequent POST to batches/ may result in a conflict if the new source cannot be confidently reconciled with the existing data. Even though you get a 201 Created response for the new batch resource, it will have a status of &ldquo;conflict&rdquo;.</p>

<h3 id="reporting-and-resolving-conflicts">Reporting and Resolving Conflicts</h3>

<p>When you attach a Source to an existing Dataset, the system attempts to match up the new data with the old. If the source&rsquo;s schema can be automatically aligned with the target Dataset, the new rows from the Batch are appended. When things go wrong, however, the Batch can be inspected to see what conflicted with the target (or vice-versa, in some cases!).</p>

<p>GET the new Batch:</p>
<pre class="highlight http"><code><span class="err">    </span><span class="nf">GET</span> <span class="nn">/api/datasets/{dataset_id}/batches/{batch_id}/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">    ...</span>
<span class="s">    --------</span>
<span class="s">    200 OK</span>
<span class="s">    Content-Type: application/shoji</span>

    {
        "element": "shoji:entity",
        ...
        "body": {
            ...,
            "conflicts": {
              "cdbd11/": {
                "metadata": {...}
                "conflicts": [{
                  "message": "Categories do not match",
                  "resolution": "Union of categories will be used."
                }]
              }
            }
        }
    }
</code></pre>

<p>If any variable conflicts, it will possess one or more &ldquo;conflicts&rdquo; members. For example, if the new variable &ldquo;cdbd11&rdquo; had extra categories or was missing some categories compared to the existing variable &ldquo;cdbd11&rdquo;, the Batch resource would contain the above message and resolution. Variables which have no conflicts will still report their metadata but have <code class="prettyprint">&quot;conflicts&quot;: []</code>.</p>

<p>The Crunch system will have done its best to resolve such conflicts for you. When it cannot, each Conflict object will likely only contain a &ldquo;message&rdquo; member. If it has resolved the conflict, it will add a &ldquo;resolution&rdquo; member.</p>

<h3 id="streaming-rows">Streaming rows</h3>

<p>Existing datasets are best sent to Crunch as a single Source, or a handful of subsequent Sources if gathered monthly or on some other schedule. Sometimes however you want to &ldquo;stream&rdquo; data to Crunch as it is being gathered, even one row at a time, rather than in a single post-processing phase. You do <em>not</em> want to make each row its own batch (it&rsquo;s simply not worth the overhead). Instead, you should make a Stream and send rows to it, then periodically create a Source and Batch from it.</p>

<h4 id="send-rows-to-a-stream">Send rows to a stream</h4>

<p>To send one or more rows to a dataset stream, simply POST one or more lines of <a href="https://en.wikipedia.org/wiki/Line_Delimited_JSON">line-delimited JSON</a> to the dataset&rsquo;s <code class="prettyprint">stream</code> endpoint:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"var_id_1"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"var_id_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight python"><code><span class="n">by_alias</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s">'alias'</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">my_system</span><span class="o">.</span><span class="n">read_a_row</span><span class="p">()</span>
    <span class="n">importing</span><span class="o">.</span><span class="n">importer</span><span class="o">.</span><span class="n">stream_rows</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="p">{</span>
        <span class="n">by_alias</span><span class="p">[</span><span class="s">"gender"</span><span class="p">]</span><span class="o">.</span><span class="nb">id</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">'gender'</span><span class="p">],</span>
        <span class="n">by_alias</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span><span class="o">.</span><span class="nb">id</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">'age'</span><span class="p">]</span>
    <span class="p">})</span>
</code></pre>

<p>The variable ids must correspond to existing variables in the dataset. The Python code shows how to efficiently map aliases to ids. The data must match the target variable types, so that we can process the row as quickly as possible. We want no casting or other guesswork slowing us down here. Among other things, this means that categorical values must be represented as Crunch&rsquo;s assigned category ids, not names or numeric values.</p>

<p>You may also send more than one row at a time if you prefer. For example, your data collection system may already post-process row data in, say, 5 minute increments. The more rows you can send together, the less overhead spent processing each one and the more you can send in a given time. Send multiple lines of line-delimited JSON, or if using pycrunch, a list of dicts rather than a single dict.</p>

<p>As when creating a new source, don&rsquo;t worry about sending values for derived variables; Crunch will fill these out for you for each row using the data you send.</p>

<h4 id="append-the-new-rows-to-the-dataset">Append the new rows to the dataset</h4>

<p>The above added new rows to the Stream resource so that you can be confident that your data is completely safe with Crunch. To append those rows to the dataset requires another step. You could stream rows and then, once they are all assembled, append them all as a single Source to the dataset. However, if you&rsquo;re streaming rows at intervals it&rsquo;s likely you want to append them to the dataset at intervals, too. But doing so one row at a time is usually counter-productive; it slows the rate at which you can send rows, balloons metadata, and interrupts users who are analyzing the data.</p>

<p>Instead, you control how often you want the streamed rows to be appended to the dataset. When you&rsquo;re ready, POST to <code class="prettyprint">datasets/{id}/batches/</code> and provide the &ldquo;stream&rdquo; member, plus any extra metadata the new Source should possess:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"stream"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ldjson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My streamed rows"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yet Another batch from the stream"</span><span class="p">,</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">"body"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"stream"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"ldjson"</span><span class="p">,</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"My streamed rows"</span><span class="p">,</span>
    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Yet Another batch from the stream"</span><span class="p">,</span>
<span class="p">}})</span>
</code></pre>

<p>The &ldquo;stream&rdquo; member tells Crunch to acquire rows from the stream to form this Batch. If <code class="prettyprint">null</code>/<code class="prettyprint">None</code>, the system will acquire all currently pending rows (any new rows which arrive during the formation of this Batch will be queued and not fetched). If an integer, the system will attempt to fetch that many rows from the stream, waiting up to 10 seconds for new ones if the number exceeds the number of pending rows. If there are no pending rows, <code class="prettyprint">409 Conflict</code> is returned instead of 201/202 for the new Batch.</p>

          <h2 id="deriving-variables">Deriving Variables</h2>

<p>Derived variables are variables that, instead of having a column of values backing them, are functionally dependent on other variables. In Crunch, users with view-only permissions on a dataset can still make derived variables of their own–just as they can make filters. Dataset editors can also derive other types of variables as permanent additions to the dataset, available for all viewers.</p>

<aside class="notice">
    In this section, sample variable documents have been trimmed to the attributes essential to the derivation examples. Actual variable documents in the wild will have more attributes than those shown here.
</aside>

<h3 id="combining-categories">Combining categories</h3>

<p>The &ldquo;combine_categories&rdquo; function takes two arguments:</p>

<ul>
<li>A reference to the categorical or categorical_array variable to be combined</li>
<li>A definition of the categories of the new variable, including all members found in categories, plus a &ldquo;combined_ids&rdquo; key that maps the derived category to one or more categories (by id) in the input variable.</li>
</ul>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"educ"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No HS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High school graduate"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some college"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2-year"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4-year"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Post-grad"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Asked"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POST&#39;ing to the private variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education (3 category)"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Combined from six-category education"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"educ3"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"combine_categories"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High school or less"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some college"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4-year college or more"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Missing"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No data"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>results in a private categorical variable with three valid categories.</p>

<p>Combining the categories of a categorical array is the same as it is for categorical variables. The resulting variable is also of type &ldquo;categorical_array&rdquo;. This variable type also has a &ldquo;subvariables_catalog&rdquo;, like the variable from which it is derived, and the subvariables contained in it are derived &ldquo;combine_categories&rdquo; categorical variables.</p>

<h3 id="combining-responses">Combining responses</h3>

<p>For multiple response variables, you may combine responses rather than categories.</p>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/455288/variables/3c2e57/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aided awareness"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aided"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"../870a2d/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../a8b0eb/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../dc444f/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../8e6279/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../f775ab/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../6405c2/"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multiple_response"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Selected"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not selected"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not asked"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No data"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Which of the following coffee brands do you recognize? Check all that apply."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POSTing to the variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aided awareness by region"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Combined from aided brand awareness"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aided_region"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"combine_responses"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/455288/variables/3c2e57/"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../870a2d/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../a8b0eb/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../dc444f/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../8e6279/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../f775ab/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Chicago"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../6405c2/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>results in a multiple response variable with three responses. The &ldquo;selected&rdquo; state of the responses in the derived variable is an &ldquo;OR&rdquo; of the combined subvariables.</p>

<h3 id="case-statements">Case statements</h3>

<p>The &ldquo;case&rdquo; function derives a variable using values from the first argument. Each of the remaining arguments contains a boolean expression. These are evaluated in order in an IF, ELSE IF, ELSE IF, &hellip;, ELSE fashion; the first one that matches selects the corresponding value from the first argument. For example, if the first two boolean expressions do not match (return False) but the third one matches, then the third value in the first argument is placed into that row in the output. You may include an extra value for the case when none of the boolean expressions match; if not provided, it defaults to the system &ldquo;No Data&rdquo; missing value.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Market segmentation"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Super-scientific classification of people"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"segments"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"case"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"column"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hipsters"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Techies"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yuppies"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Other"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55fc29/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]}]},</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;="</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"673dde/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}]}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"889dc3/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]}]},</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"673dde/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">}]}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"=="</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"13cbf4/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}]}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="weights">Weights</h3>

<p>A numeric variable suitable for use as row weights can be constructed from one or more categorical variables and target proportions of their categories. The sample distribution is “raked” iteratively to each categorical marginal target to produce a set of joint values that can be used as weights. Note that available weight variables are shared by all; you may not create private weights. To create a weight variable, POST a JSON variable definition to the variables catalog describing the properties of the weight variable, with an &ldquo;expr&rdquo; member indicating to use the &ldquo;rake&rdquo; function, which takes a &ldquo;targets&rdquo; argument containing an array of Crunch Tables of targets:</p>
<pre class="highlight shell"><code>POST /api/datasets/<span class="o">{</span>datasetid<span class="o">}</span>/variables/ HTTP/1.1
Content-Type: application/shoji
Content-Length: 739
<span class="o">{</span>
    <span class="s2">"name"</span>: <span class="s2">"weight"</span>,
    <span class="s2">"description"</span>: <span class="s2">"my raked weight"</span>,
    <span class="s2">"expr"</span>: <span class="o">{</span>
        <span class="s2">"function"</span>: <span class="s2">"rake"</span>,
        <span class="s2">"args"</span>: <span class="o">{</span>
            <span class="s2">"targets"</span>: <span class="o">[</span>
                <span class="o">{</span>
                    <span class="s2">"{variable1.id}"</span>: <span class="o">[</span>1, 2],
                    <span class="s2">"target"</span>: <span class="o">[</span>49.1, 50.9]
                <span class="o">}</span>,
                …
            <span class="o">]</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
---------
201 Created
Location: /api/datasets/<span class="o">{</span>datasetid<span class="o">}</span>/variables/<span class="o">{</span>variableid<span class="o">}</span>/
</code></pre>

<h3 id="other-transformations">Other transformations</h3>

<p>Forthcoming.</p>

          <h2 id="array-variables">Array Variables</h2>

<p>Simple variables have only one value per row; sometimes, however, it is convenient to consider multiple values (of the same type) as a single Variable. The Crunch system implements these as an array of &ldquo;subvariables&rdquo; which are defined as any other variable, but are then bound together into a single logical &ldquo;parent&rdquo; variable. These come in two types of parent variable: categorical array and multiple response.</p>

<h3 id="categorical-arrays">Categorical arrays</h3>

<p>For the &ldquo;categorical_array&rdquo; type, each subvariable is considered distinct, and a row may have a different value for each of them. For example, you might field a survey where you ask respondents to rate soft drinks by filling in a grid of a set of brands versus a set of ratings:</p>
<pre class="highlight plaintext"><code>72. How much do you like each soft drink?
       Not at all   Not much   OK   A bit   A lot
 Coke       o           o      o      o       o
Pepsi       o           o      o      o       o
   RC       o           o      o      o       o
</code></pre>

<p>The respondent may only select one rating in each row. To represent that answer data in Crunch, you would first define a Variable for &ldquo;Coke&rdquo;, one for &ldquo;Pepsi&rdquo;, and one for &ldquo;RC&rdquo;. Each of them would be of type &ldquo;categorical&rdquo;, with a set of categories like:</p>
<pre class="highlight json"><code><span class="s2">"categories"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">    </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not at all"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not much"</span><span class="p">,</span><span class="w">   </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w">         </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A bit"</span><span class="p">,</span><span class="w">      </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A lot"</span><span class="p">,</span><span class="w">      </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">    </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>These variables would be populated like any other Variable of type &ldquo;categorical&rdquo;. For example, when sending data Column-by-column, you might POST a Variable Entity with the payload:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Coke"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w">
        </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Once all of the individual variables have been defined (you don&rsquo;t have to have all their data added yet), then you may create the parent array variable. Doing so by POSTing a Variable Entity would have a payload like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Soft Drinks"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Coke"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Pepsi"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"RC"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The &ldquo;Soft Drinks&rdquo; categorical array variable may now be included in analyses like any other variable, but has 2 dimensions instead of the typical 1. For example, a crosstab of a 1-dimensional &ldquo;Gender&rdquo; variable with a 1-dimensional &ldquo;Education&rdquo; variable yields a 2-D cube. A crosstab of 1-D &ldquo;Gender&rdquo; by 2-D &ldquo;Soft Drinks&rdquo; yields a 3-D cube.</p>

<h3 id="multiple-response">Multiple response</h3>

<p>The second type of array is &ldquo;multiple_response&rdquo;. These arrays look very similar to categorical_array variables in their data representations, but are usually gathered very differently and behave differently in analyses. For example, you might field a survey where you ask respondents to select countries they have visited:</p>
<pre class="highlight plaintext"><code>38. Which countries have you visited?

[] USA
[] Germany
[] Japan
[] None of the above 
</code></pre>

<p>The respondent may check the box or not for each row. To represent that answer data in Crunch, you would first define a Variable for &ldquo;USA&rdquo;, one for &ldquo;Germany&rdquo;, one for &ldquo;Japan&rdquo;, and one for &ldquo;None of the above&rdquo;. Each of them would be of type &ldquo;categorical&rdquo;.</p>
<pre class="highlight json"><code><span class="s2">"categories"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Checked"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not checked"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">98</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not shown"</span><span class="p">,</span><span class="w">   </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>These variables would be populated like any other Variable of type &ldquo;categorical&rdquo;. For example, when sending data Column-by-column, you might POST a Variable Entity with the payload:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w">
        </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Once all of the individual variables have been defined (you don&rsquo;t have to have all their data added yet), then you may create the parent array variable. Doing so by POSTing a Variable Entity would have a payload like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Countries Visited"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multiple_response"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"USA"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Germany"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Japan"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">],</span><span class="w">
        </span><span class="nt">"selected_categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Checked"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Aside from the new type name, the primary difference from the basic categorical array is that one or more categories are marked as &ldquo;selected&rdquo;. These are then used to dichotomize the categories such that any subvariable response is treated more as if it were true or false (selected or unselected) than maintaining the difference between each category. If POSTing to create &ldquo;multiple_response&rdquo;, you may include a &ldquo;selected_categories&rdquo; key in the body, containing an array of category names that indicate the dichotomous selection. If you do not include &ldquo;selected_categories&rdquo;, there must be at least one &ldquo;selected&rdquo;: true category in the subvariables you are binding into the multiple-response variable to indicate the dichotomous selection–see Object Reference#categories. If neither are true, the request will return 400 status.</p>

<p>The &ldquo;Countries Visited&rdquo; categorical array variable may now be included in analyses like any other variable, but with a noticeable difference. Rather than contributing a dimension of distinct categories, it instead contributes a dimension of distinct subvariables. For example, a crosstab of a 1-dimensional &ldquo;Gender&rdquo; variable with a 1-dimensional &ldquo;Education&rdquo; variable yields a 2-D cube: one dimension of the categories of Gender and one dimension of the categories of Education. A crosstab of 1-D &ldquo;Gender&rdquo; by the multiple response &ldquo;Countries Visited&rdquo; also yields a 2-D cube: one dimension of the categories of Gender but the other dimension has one entry for &ldquo;USA&rdquo;, one for &ldquo;Germany&rdquo;, one for &ldquo;Japan&rdquo;, and one for &ldquo;None of the above&rdquo;.</p>

<p>A quirk of multiple response variables is that analyses of them often require knowledge across subvariables: which rows had any subvariable selected, which rows had no subvariable selected, and which rows had all subvariables marked as &ldquo;missing&rdquo;. The Crunch system calculates these ancillary &ldquo;subvariables&rdquo; for you, and includes them in analysis output. Including an explicit &ldquo;None of the above&rdquo; subvariable in the example above complicates this, since Crunch has no way of knowing to treat such subvariables specially; it will faithfully consider the &ldquo;None of the above&rdquo; subvariable like any other subvariable when calculating the any/none/missing views. Depending on your application, you may wish to 1) not even include that option in your survey, 2) skip adding that variable to your Crunch dataset, 3) add it but do not bind it into the parent array variable, or 4) include it and have it be treated like any other multiple response subvariable in your analyses.</p>

<h3 id="naming-subvariables">Naming Subvariables</h3>

<p>To define array variables, you must first define the categorical variables that comprise them, then bind them into an array by POSTing a variable definition with type &ldquo;categorical_array&rdquo; or &ldquo;multiple_response&rdquo; and a &ldquo;subvariables&rdquo; key, which contains an array of URLs of the categorical variables. See above for examples. There is not currently a one-step method of defining an array variable without first defining its constituent parts. </p>

<p>Given the uniqueness constraint on names, along with the procedure for creating array variables, you may encounter challenges when trying to create many array variables that have subvariables with names in common. If you were to try to define all of your subvariables first, then bind sets of them into arrays, you would fail because of the constraint that non-subvariable names must be unique. This is because the individual variables aren&rsquo;t considered &ldquo;subvariables&rdquo; until you bind them into arrays–they&rsquo;re regular variables, subject to the uniqueness constraint. A solution is to add array subvariables one array at a time and bind them into the array before adding the next array&rsquo;s subvariables.</p>

<h3 id="adding-new-subvariables">Adding new subvariables</h3>

<p>In the scenario that a variable was left out when creating an array variable, it is possible to modify the array variable so that new subvariables get added (always on the last position).</p>

<p>To do so, the subvariable-to-be should currently be a variable of the dataset and have the same type as the subvariables (&ldquo;categorical&rdquo;).</p>

<p>Send a PATCH request containing the url of the new subvariable with an empty object as its tuple:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"http://.../url/new/subvariable/"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A 204 response will indicate that the catalog was updated, and the new subvariable now is part of the array variable.</p>

          <h2 id="multidimensional-analysis">Multidimensional analysis</h2>

<p>In the Crunch system, any analysis is also referred to as a &ldquo;cube&rdquo;. Cubes are the mechanical means of representing analyses to and from the Crunch system; you can think of them as spreadsheets that might have other than two dimensions. A cube consists of two primary parts: &ldquo;dimensions&rdquo; which supply the cube axes, and &ldquo;measures&rdquo; which populate the cells. Although both the request and response include dimensions and measures, it is important to distinguish between them. The request supplies expressions for each, while the response has data (and metadata) for each. The request declares what variables to use and what to do with them, while the response includes and describes the results. See Object Reference:Cube for complete details.</p>

<h3 id="dimensions">Dimensions</h3>

<p>Each dimension of an analysis can be simply one variable, a function over it, a traversal of its subvariables (for array variables), or even a combination of multiple variables (e.g. A + B). Any expression you can use in a &ldquo;select&rdquo; command can be used as a dimension. The big difference is that the system will consider the distinct values rather than all values of the result. Variables which are already &ldquo;categorical&rdquo; or &ldquo;enumerated&rdquo; will simply use their &ldquo;categories&rdquo; or &ldquo;elements&rdquo; as the extent. Other variables form their extents from their distinct values.</p>

<p>For example, if &ldquo;3ffd45&rdquo; is a categorical variable with three categories (one of which is &ldquo;No Data&rdquo;: -1), then the following dimension expressions:</p>
<pre class="highlight json"><code><span class="s2">"dimensions"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/3ffd45/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/2098f1/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}]}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>&hellip;would form a result cube with two dimensions: one using the categories of variable &ldquo;3ffd45&rdquo;, and one using the distinct values of (variable &ldquo;2098f1&rdquo; + 5). If variable &ldquo;2098f1&rdquo; has the distinct values [5, 15, 25, 35], then we would obtain a cube with the following extents:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>5</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>25</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>35</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p>Each dimension used in a cube query needs to be reduced to distinct values. For categorical or enumerated variables, we only need to refer to the variable, and the system will automatically use the &ldquo;categories&rdquo; or &ldquo;elements&rdquo; metadata to determine the distinct values. For other types, the default is to scan the variable&rsquo;s data to find the unique values present and use those. Often, however, we want a more sophisticated approach: numeric variables, for example, are usually more useful when binned into a handful of ranges, like &ldquo;0 to 10, 10 to 20, &hellip;90 to 100&rdquo; rather than 100 distinct points (or many more when dealing with non-integers). The available dimensioning functions vary from type to type; the most common are:</p>

<ul>
<li>categorical: {&ldquo;variable&rdquo;: url}</li>
<li>text: {&ldquo;variable&rdquo;: url}</li>
<li>numeric:  Group the distinct values into a smaller number of bins via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;bin&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}]}</li>
</ul></li>
<li>datetime: Roll up seconds into hours, days into months, or any other grouping via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;rollup&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}, {&ldquo;value&rdquo;: variable.rollup_resolution}]}</li>
</ul></li>
<li>categorical_array:

<ul>
<li>One dimension for the categories: {&ldquo;variable&rdquo;: url}</li>
<li>One dimension for the subvariables: {&ldquo;each&rdquo;: url}</li>
</ul></li>
<li>multiple response: 

<ul>
<li>One dimension for the selected categories, which means transforming the array from a set of categorical variables to a set of boolean (true/false) variables via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;selected_array&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}]}</li>
<li>Note that, because this input dimension is now a boolean, it will not add an output dimension. Instead, it will filter the calculation to only consider those entries (for each subvariable) which are true, which means they were selected categories. If you wish to have a separate output dimension including each distinct category (whether selected or not), do not apply the &ldquo;selected_array&rdquo; function; instead, just supply the variable reference as-is.
One dimension for the subvariables: {&ldquo;each&rdquo;: url}</li>
</ul></li>
</ul></li>
</ul>

<h3 id="measures">Measures</h3>

<p>A set of named functions to populate each cell of the cube. You can request multiple functions over the same dimensions (such as “cube_mean” and “cube_stddev”) or more commonly just one (like “cube_count”). For example:</p>
<pre class="highlight json"><code><span class="s2">"measures"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
</span></code></pre>

<p>or:</p>
<pre class="highlight json"><code><span class="w">    </span><span class="s2">"measures"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_mean"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/1/variables/3"</span><span class="p">}]},</span><span class="w">
        </span><span class="nt">"stddev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_stddev"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/1/variables/3/"</span><span class="p">}]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>When applied to the dimensions we defined above, this second example might fill the table thusly for the &ldquo;mean&rdquo; measure:</p>

<table><thead>
<tr>
<th>mean</th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>5</td>
<td>4.3</td>
<td>12.3</td>
<td>8.1</td>
</tr>
<tr>
<td>15</td>
<td>13.1</td>
<td>0.0</td>
<td>9.2</td>
</tr>
<tr>
<td>25</td>
<td>72.4</td>
<td>4.2</td>
<td>55.5</td>
</tr>
<tr>
<td>35</td>
<td>8.9</td>
<td>9.1</td>
<td>0.4</td>
</tr>
</tbody></table>

<p>&hellip;and produce a similar one for the &ldquo;stddev&rdquo; measure. You can think of multiple measures as producing &ldquo;overlays&rdquo; over the same dimensions. However, the actual output format (in JSON) is more compact in that the dimensions are not repeated; see Object Reference:Cube output for details.</p>

<h3 id="comparisons">Comparisons</h3>

<p>Occasionally, it is useful to compare analyses from different sources. A common example is to define &ldquo;benchmarks&rdquo; for a given analysis, so that you can quickly compare an analysis to an established target. These are, in effect, one analysis laid over another in such a way that at least one of their dimensions lines up (and typically, using the same measures). These are also therefore defined in terms of cubes: one set which defines the base analyses, and another which defines the overlay.</p>

<p>For example, if we have an analysis over two categorical variables &ldquo;88dd88&rdquo; and &ldquo;ee4455&rdquo;:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/88dd88/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/ee4455/"</span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>then we might obtain a cube with the following output:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>15</td>
<td>12</td>
<td>9</td>
</tr>
<tr>
<td>2</td>
<td>72</td>
<td>8</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>23</td>
<td>4</td>
<td>17</td>
</tr>
</tbody></table>

<p>Let&rsquo;s say we then want to overlay a comparison showing benchmarks for 88dd88 as follows:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
<th>benchmarks</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>15</td>
<td>12</td>
<td>9</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>72</td>
<td>8</td>
<td>3</td>
<td>70</td>
</tr>
<tr>
<td>3</td>
<td>23</td>
<td>4</td>
<td>17</td>
<td>10</td>
</tr>
</tbody></table>

<p>Our first pass at this might be to generate the benchmark targets in some other system, and hand-enter them into Crunch. To accomplish this, we need to define a comparison. First, we need to define the &ldquo;bases&rdquo;: the cube(s) to which our comparison applies, which in our case is just the above cube:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My benchmark"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Notice, however, that we&rsquo;ve left out the second dimension. This means that this comparison will be available for any analysis where &ldquo;88dd88&rdquo; is the row dimension. The base cube here is a sort of &ldquo;supercube&rdquo;: a superset of the cubes to which we might apply the comparison. We include the measure to indicate that this comparison should apply to a &ldquo;cube_count&rdquo; (frequency count) involving variable &ldquo;88dd88&rdquo;.</p>

<p>Then, we need to define target data. We are supplying these in a hand-generated way, so our measure is simply a static column instead of a function:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"overlay"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"column"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">],</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"typeof"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}]}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Note that our overlay has to have a dimension, too. In this case, we simply re-use variable &ldquo;88dd88&rdquo; as the dimension. This ensures that our target data is interpreted with the same category metadata as our base analysis.</p>

<p>We POST the above to datasets/{id}/comparisons/ and can obtain the overlay output at datasets/{id}/comparisons/{comparison_id}/cube/. See the Endpoint Reference for details.</p>

<h3 id="multitables">Multitables</h3>

<p>Analyses as described above are truly multidimensional; when you add another variable, the resulting cube obtains another dimension. Sometimes, however, you want to compare analyses side by side, typically looking at several (even <em>all</em>) variables against a common set of conditioning variables. For example, you might nominate &ldquo;Gender&rdquo;, &ldquo;Age&rdquo;, and &ldquo;Race&rdquo; as the conditioning variables and cross every other variable with those, in order to quickly discover common correlations. </p>

<p>Multi-table definitions mainly provide a <code class="prettyprint">template</code> member that clients can use to construct a valid query with the variable(s) of interest.</p>

<p>Crunch provides a separate catalog where you can define and manage these common sets of variables. Like most catalogs, you can GET it to see which multitables are defined:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">datasets/{id}/multitables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

200 OK
{
    "element": "shoji:catalog",
    "index": {
        "1/": {"name": "Major demographics"},
        "2/": {"name": "Political tendencies"}
    }
}
</code></pre>

<p>&hellip;POST a new overview:</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">datasets/{id}/multitables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    "element": "shoji:entity",
    "body": {
        "name": "Geographical indicators",
        "template": [
            {
                "variable": "../variables/de85b32/",
                "query": [
                    {
                        "variable": "../variables/de85b32/"
                    }
                ]
            },
            {
                "variable": "../variables/398620f/",
                "query": [
                    {
                        "variable": "../variables/398620f/"
                    }
                ]
            },
            {
                "variable": "../variables/c116a77/",
                "query": [
                    {
                        "function": "bin",
                        "args": [
                            {
                                "variable": "../variables/398620f/"
                            }
                        ]
                    }
                ]
            }
        ],
        "is_public": false
    }
}

201 Created
Location: datasets/{id}/multitables/3/
</code></pre>

<p>&hellip;or GET an individual multitable:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">datasets/{id}/multitable/3/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    "element": "shoji:entity",
    "body": {
        "name": "Geographical indicators",
        "template": [
            {
                "variable": "../variables/de85b32/",
                "query": [
                    {
                        "variable": "../variables/de85b32/"
                    }
                ]
            },
            {
                "variable": "../variables/398620f/",
                "query": [
                    {
                        "variable": "../variables/398620f/"
                    }
                ]
            },
            {
                "variable": "../variables/c116a77/",
                "query": [
                    {
                        "function": "bin",
                        "args": [
                            {
                                "variable": "../variables/398620f/"
                            }
                        ]
                    }
                ]
            }
        ]
    }
}
</code></pre>

<p>Each multi-table template may be a list of variable references and other information used to construct the dimension and transform its output.</p>

<h3 id="more-complex-multitable-templates">More complex multitable templates</h3>

<p>The template may contain in addition to variable references and their query arguments, an optional <code class="prettyprint">transform</code>: \
To obtain their multiple output cubes, you <code class="prettyprint">GET datasets/{id}/cube?query=&lt;q&gt;</code> where <code class="prettyprint">&lt;q&gt;</code> is a ZCL object in JSON format (which must then be URI encoded for inclusion in the querystring). Use the &ldquo;each&rdquo; function to iterate over the overview variables’ <code class="prettyprint">query</code>, producing one output cube for each one as &ldquo;variable x&rdquo;. For example, to cross each of the above 3 variables against another variable &ldquo;449b421&rdquo;:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"each"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de85b32"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"398620f"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c116a77"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"block"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The result will be an array of output cubes:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de85b32"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"398620f"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c116a77"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="transforming-analyses-for-presentation">Transforming analyses for presentation</h3>

<p>The <code class="prettyprint">transform</code> member of an analysis specification (or multitable definition)
provides a way to transform that dimension&rsquo;s results after computation. The 
cube result dimension will always be derived from the <code class="prettyprint">query</code> part of the
request (<code class="prettyprint">{variable: $variableId})</code>, <code class="prettyprint">{function: f, args: [$variableId, …]}</code>, &amp;c.</p>

<h3 id="structure">Structure</h3>

<p>A <code class="prettyprint">transform</code> is an array of target transforms for output-dimension elements. 
Therefore to create a valid <code class="prettyprint">transform</code> it is generally necessary to make a cube query, inspect
the result dimension, and proceed from there. For categorical and multiple response
variables, elements may also be obtained from the variable entity.</p>

<p>Transforms are designed for variables that are more stable than not, with element ids
that inhere in the underlying elements, such as category or subvariable ids. Dynamic
elements such as results of <code class="prettyprint">bin</code>ning a numeric variable, may not be transformed.</p>

<p>Consider the following example result dimension:</p>

<table><thead>
<tr>
<th>Name</th>
<th>missing</th>
<th>id</th>
</tr>
</thead><tbody>
<tr>
<td>Element A</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Element B</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>Element C</td>
<td></td>
<td>2</td>
</tr>
<tr>
<td>Don’t know</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>Not asked</td>
<td>true</td>
<td>4</td>
</tr>
</tbody></table>

<p>A full <code class="prettyprint">transform</code> can specify a new order of output elements, new names, 
and in the future, bases for hypothesis testing, result sorting, and 
aggregation of results. A <code class="prettyprint">transform</code> has elements that look generally like
the dimension&rsquo;s extent, with some optional properties: </p>

<ul>
<li><strong>id</strong>: (required) id or array of ids in the target row/column</li>
<li><strong>name</strong>: name of new target column</li>
<li><strong>sort</strong>: <code class="prettyprint">-1</code> or <code class="prettyprint">1</code> indicating to sort results descending or ascending by this element</li>
<li><strong>compare</strong>: <code class="prettyprint">neq</code>, <code class="prettyprint">leq</code>, <code class="prettyprint">geq</code> indicating to test other rows/columns against
the hypothesis that they are ≠, ≤, or ≥ to the present element</li>
<li><strong>combine</strong>: <code class="prettyprint">sum</code> (or <code class="prettyprint">mean</code>?) — combine the indices in <code class="prettyprint">[i]</code> to produce this target row/column</li>
<li><strong>hide</strong>: suppress this element&rsquo;s row/column from displaying at all. Defaults to false for valid elements, true for missing, so that if an element is added, it will be present until a transform with <code class="prettyprint">hide: true</code> is added to suppress it.</li>
</ul>

<p>A <code class="prettyprint">transform</code> with object members can do lots of things. Suppose we want to put <em>Element C</em> first, 
hide the <em>Don’t know</em>, and more compactly represent the result as just <em>C, A, B</em>:</p>
<pre class="highlight json"><code><span class="err">transform:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">2,</span><span class="w"> </span><span class="err">'name':</span><span class="w"> </span><span class="err">'C'</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">'name':</span><span class="w"> </span><span class="err">'A'</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">1,</span><span class="w"> </span><span class="err">'name':</span><span class="w"> </span><span class="err">'B'</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">3,</span><span class="w"> </span><span class="err">'hide':</span><span class="w"> </span><span class="err">true</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h4 id="in-the-future-combine">In the future: <code class="prettyprint">combine</code></h4>

<p>Suppose we want to combine results in <em>A</em> and <em>B</em> into <em>Others</em>:</p>
<pre class="highlight json"><code><span class="err">transform:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">2,</span><span class="w"> </span><span class="err">'name':</span><span class="w"> </span><span class="err">'C'</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">[0,1],</span><span class="w"> </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Others',</span><span class="w"> </span><span class="err">'combine':</span><span class="w"> </span><span class="err">'sum'</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="err">'id':</span><span class="w"> </span><span class="err">3,</span><span class="w"> </span><span class="err">'hide':</span><span class="w"> </span><span class="err">true</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h4 id="order-of-transform-operations">Order of transform operations</h4>

<ol>
<li>Combine</li>
<li>Name</li>
<li>Order</li>
<li>Hide</li>
</ol>

<h4 id="example-transform-in-a-saved-analysis">Example transform in a saved analysis</h4>

<p>In a saved analysis the transforms are an array in <code class="prettyprint">display_settings</code> with the same extents output dimensions (as well as, of course, the query used to generate them). This syntax makes a univariate table of a multitple response variable and re-orders the result.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selected_array"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/398620f/"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/398620f/"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f007"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My preferred first item"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fee7"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The zeroth response"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c001"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Third response"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="example-transform-in-a-multitable-template">Example transform in a multitable template</h4>

<p>In a multitable, the <code class="prettyprint">transform</code> is part of each dimension definition object in the <code class="prettyprint">template</code> array. </p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{},</span><span class="w">
                </span><span class="p">{}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id="endpoint-reference">Endpoint Reference</h1>

          <h2 id="public">Public</h2>

          <h2 id="datasets">Datasets</h2>

<p>Datasets are the primary containers of statistical data in Crunch. Datasets contain a collection of <a href="#variables">variables</a>, with which analyses can be composed, saved, and exported. These analyses may include filters, which users can define and persist. Users can also share datasets with each other.</p>

<p>Datasets are comprised of one or more batches of data uploaded to Crunch, and additional batches can be appended to datasets. Similarly, variables from other datasets can be joined onto a dataset.</p>

<p>As with other objects in Crunch, references to the set of dataset entities are exposed in a catalog. This catalog can be organized and ordered.</p>

<h3 id="catalog">Catalog</h3>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># Upon logging in, a GET /datasets/ is done automatically, to populate:
</span><span class="n">listDatasets</span><span class="p">()</span> <span class="c1"># Shows the names of all datasets you have
</span><span class="n">listDatasets</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span> <span class="c1"># Refreshes that list (and does GET /datasets/)
</span>
<span class="c1"># To get the raw Shoji object, should you need it,
</span><span class="n">crGET</span><span class="p">(</span><span class="s2">"https://beta.crunch.io/api/datasets/"</span><span class="p">)</span>
</code></pre>
<pre class="highlight python"><code></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/order/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/datasets/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"James T. Kirk"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Voyage Home"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8390"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"add_users"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"change_weight"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">67</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/685722/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2286"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/ff9443/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Leonard Nimoy"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Spock"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Wrath of Khan"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"add_users"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"change_weight"</span><span class="p">:,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/af432c/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-03"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-20"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET /datasets/</code></p>

<p>When authenticated, GET returns 200 status with a Shoji Catalog of datasets to which the authenticated user has access. Catalog tuples contain the following attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required. The name of the dataset</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>A longer description of the dataset</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td></td>
<td>The dataset&rsquo;s id</td>
</tr>
<tr>
<td>archived</td>
<td>bool</td>
<td>false</td>
<td>Whether the dataset is &ldquo;archived&rdquo; or active</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td><code class="prettyprint">{&quot;edit&quot;: false}</code></td>
<td>Authorizations on this dataset. See <a href="#permissions">Permissions</a>.</td>
</tr>
<tr>
<td>owner_id</td>
<td>URL</td>
<td></td>
<td>URL of the user entity of the dataset&rsquo;s owner</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>size</td>
<td>object</td>
<td><code class="prettyprint">{&quot;rows&quot;: null, &quot;columns&quot;: null}</code></td>
<td>Dimensions of the dataset</td>
</tr>
<tr>
<td>creation_time</td>
<td>ISO-8601 string</td>
<td></td>
<td>Datetime at which the dataset was created in Crunch</td>
</tr>
<tr>
<td>start_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>Date/time for which the data in the dataset corresponds</td>
</tr>
<tr>
<td>end_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>End date/time of the dataset&rsquo;s data, defining a start_date:end_date range</td>
</tr>
<tr>
<td>current_editor</td>
<td>URL or null</td>
<td></td>
<td>URL of the user entity that is currently editing the dataset, or <code class="prettyprint">null</code> if there is no current editor</td>
</tr>
<tr>
<td>current_editor_name</td>
<td>string or null</td>
<td></td>
<td>That user&rsquo;s name, for display</td>
</tr>
</tbody></table>

<aside class="notice">
    A user may have access to a dataset because someone has shared it directly with him, or because someone has shared it with a team of which he is a member. If a user has access to a dataset from different sources, be it by multiple teams or by direct sharing, the final permissions they have on the dataset will be the maximum of all the permissions granted.
</aside>

<h4 id="patch">PATCH</h4>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/api/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">231</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8130.4"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># Dataset objects contain information from
# the catalog tuple and the dataset entity.
# Editing attributes by &lt;- assignment will
# PATCH or PUT the right payload to the
# right place--you don't have to think about
# catalogs and entities.
</span><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s2">"The Wrath of Khan"</span><span class="p">)</span>
<span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="c1">## [1] ""
</span><span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="s2">"Stardate 8130.4"</span>
<span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="c1">## [1] "Stardate 8130.4"
</span>
<span class="c1"># If you needed to touch HTTP more directly,
# you could:
</span><span class="n">payload</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">(</span>
    <span class="sb">`https://beta.crunch.io/api/datasets/a598c7/`</span><span class="o">=</span><span class="n">list</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 8130.4"</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">crPATCH</span><span class="p">(</span><span class="s2">"https://beta.crunch.io/api/datasets/"</span><span class="p">,</span>
    <span class="n">body</span><span class="o">=</span><span class="n">toJSON</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight python"><code></code></pre>

<p><code class="prettyprint">PATCH /datasets/</code></p>

<p>Use PATCH to edit the &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;start_date&rdquo;, &ldquo;end_date&rdquo;, or &ldquo;archived&rdquo; state of one or more datasets. A successful request returns a 204 response. The attributes changed will be seen by all users with access to this dataset; i.e., names, descriptions, and archived state are not merely attributes of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset(s) being modified, as shown in the &ldquo;permissions&rdquo; object in the catalog tuples. If you try to PATCH and are not authorized, you will receive a 403 response and no changes will be made.</p>

<p>The tuple attributes other than &ldquo;name&rdquo;, &ldquo;description&rdquo;, and &ldquo;archived&rdquo; cannot be modified here by PATCH. Attempting to modify other attributes, or including new attributes, will return a 400 response. Changing permissions is accomplished by PATCH on the permissions catalog, and changing the owner is a PATCH on the dataset entity. The &ldquo;owner_name&rdquo; and &ldquo;current_editor_name&rdquo; attributes are modifiable, assuming authorization, by PATCH on the associated user entity. Dataset &ldquo;size&rdquo; is a cached property of the data, changing only if the number of rows or columns in the dataset change. Dataset &ldquo;id&rdquo; and &ldquo;creation_time&rdquo; are immutable.</p>

<p>When PATCHing, you may include only the keys in each tuple that are being modified, or you may send the complete tuple. As long as the keys that cannot be modified via PATCH here are not modified, the request will succeed.</p>

<p>Note that, unlike other Shoji Catalog resources, you cannot PATCH to add new datasets, nor can you PATCH a null tuple to delete them. Attempting either will return a 400 response. Creating datasets is allowed only by POST to the catalog, while deleting datasets is accomplished via a DELETE on the dataset entity.</p>

<h4 id="post">POST</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">88</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 4523.3"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://beta.crunch.io/api/datasets/223fd4/</span>

</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># To create just the dataset entity, you can
</span><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">createDataset</span><span class="p">(</span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 4523.3"</span><span class="p">)</span>

<span class="c1"># More likely, you'll have a data.frame or
# similar object in R, and you'll want to send
# it to Crunch. To do that,
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">read.csv</span><span class="p">(</span><span class="s2">"~/tribbles.csv"</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">newDataset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 4523.3"</span><span class="p">)</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight python"><code></code></pre>

<p><code class="prettyprint">POST /datasets/</code></p>

<p>POST a JSON object to create a new Dataset; a 201 indicates success, and the returned Location header refers to the new Dataset resource.</p>

<p>The body must contain a &ldquo;name&rdquo;, and additional parameters &ldquo;description&rdquo; and &ldquo;archived&rdquo; are allowed. You can also include a Crunch Table in a &ldquo;table&rdquo; key, as discussed in the Feature Guide. Sending any other attribute will return a 400 response.</p>

<h3 id="other-catalogs">Other catalogs</h3>

<p>In addition to <code class="prettyprint">/datasets/</code>, there are a few other catalogs of datasets in the API:</p>

<h4 id="team-datasets">Team datasets</h4>

<p><code class="prettyprint">/teams/{team_id}/datasets/</code></p>

<p>A Shoji Catalog of datasets that have been shared with this team. These datasets are not included in the primary dataset catalog. See <a href="#teams">teams</a> for more.</p>

<h4 id="filter-datasets-by-name">Filter datasets by name</h4>

<p><code class="prettyprint">/datasets/by_name/{dataset_name}/</code></p>

<p>The <code class="prettyprint">by_name</code> catalog returns (on GET) a Shoji Catalog that is a subset of <code class="prettyprint">/datasets/</code> where the dataset name matches the &ldquo;dataset_name&rdquo; value. Matches are case sensitive.</p>

<p>Verbs other than GET are not supported on this subcatalog. PATCH and POST at the primary dataset catalog.</p>

<h3 id="entity">Entity</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/</code></p>

<h5 id="url-parameters">URL Parameters</h5>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dataset_id</td>
<td>The id of the dataset</td>
</tr>
</tbody></table>

<h5 id="dataset-attributes">Dataset attributes</h5>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required. The name of the dataset</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>A longer description of the dataset</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>Additional information you want to associate with this dataset</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td></td>
<td>The dataset&rsquo;s id</td>
</tr>
<tr>
<td>archived</td>
<td>bool</td>
<td>false</td>
<td>Whether the dataset is &ldquo;archived&rdquo; or active</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td><code class="prettyprint">{&quot;edit&quot;: false}</code></td>
<td>Authorizations on this dataset. See <a href="#permissions">Permissions</a>.</td>
</tr>
<tr>
<td>owner_id</td>
<td>URL</td>
<td></td>
<td>URL of the user entity of the dataset&rsquo;s owner</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>size</td>
<td>object</td>
<td><code class="prettyprint">{&quot;rows&quot;: null, &quot;columns&quot;: null}</code></td>
<td>Dimensions of the dataset</td>
</tr>
<tr>
<td>creation_time</td>
<td>ISO-8601 string</td>
<td></td>
<td>Datetime at which the dataset was created in Crunch</td>
</tr>
<tr>
<td>start_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>Date/time for which the data in the dataset corresponds</td>
</tr>
<tr>
<td>end_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>End date/time of the dataset&rsquo;s data, defining a start_date:end_date range</td>
</tr>
<tr>
<td>current_editor</td>
<td>URL or null</td>
<td></td>
<td>URL of the user entity that is currently editing the dataset, or <code class="prettyprint">null</code> if there is no current editor</td>
</tr>
<tr>
<td>current_editor_name</td>
<td>string or null</td>
<td></td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>weight</td>
<td>URL</td>
<td>null</td>
<td>Points to the current weight variable applied for the given user</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p><code class="prettyprint">PATCH /datasets/{dataset_id}/</code></p>

<p>See above about PATCHing the dataset catalog for all attributes duplicated on the entity and the catalog. You may PATCH those attributes on the entity, but you are encouraged to PATCH the catalog instead. The two attributes appearing on the entity and not the catalog, &ldquo;notes&rdquo; and &ldquo;weight&rdquo;, are modifiable by PATCH here.</p>

<p>A successful PATCH request returns a 204 response. The attributes changed will be seen
by all users with access to this dataset; i.e., names, descriptions, and archived
state are not merely attributes of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on this dataset.
 If you try to PATCH and are not authorized, you will receive a 403 response
 and no changes will be made. If you have edit permissions but are not the
 current editor of this dataset, PATCH requests of anything other than &ldquo;current_editor&rdquo; will respond with 409 status. You will need first to PATCH to make yourself
  the current editor and then proceed to make the desired changes.</p>

<p>When PATCHing, you may include only the keys that are being
modified, or you may send the complete entity. As long as the keys that cannot be
modified via PATCH here are not modified, the request will succeed.</p>

<h4 id="delete">DELETE</h4>

<p><code class="prettyprint">DELETE /datasets/{dataset_id}/</code></p>

<p>With sufficient authorization, a successful DELETE request removes the dataset from the Crunch system and responds with 204 status.</p>

<h4 id="views">Views</h4>

<h5 id="applied-filters">Applied filters</h5>

<h5 id="cube">Cube</h5>

<p><code class="prettyprint">/datasets/{id}/cube/?q</code></p>

<p>See <a href="#multidimensional-analysis">Multidimensional Analysis</a>.</p>

<h5 id="export">Export</h5>

<p><code class="prettyprint">/datasets/{id}/export/</code></p>

<p>GET returns a Shoji View of available dataset export formats.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/223fd4/export/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"spss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/223fd4/export/spss/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="summary">Summary</h5>

<p><code class="prettyprint">/datasets/{id}/summary/{?filter}</code></p>

<h6 id="query-parameters">Query Parameters</h6>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>filter</td>
<td>A Crunch filter expression</td>
</tr>
</tbody></table>

<p>GET returns a Shoji View with summary information about this dataset containing
 its number of rows (weighted and unweighted, with and without your applied filters), as well as the number of variables and columns. The column count will differ from the variable count when derived and array variables are present&ndash;these variable types don&rsquo;t necessarily have their own columns of data behind them. The column count is useful for estimating load time and file size when exporting.</p>

<p>If a <code class="prettyprint">filter</code> is included, the &ldquo;filtered&rdquo; counts will be with respect to that expression. If omitted, your applied filters will be used.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/223fd4/summary/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"unweighted"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"filtered"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"weighted"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"filtered"</span><span class="p">:</span><span class="w"> </span><span class="mf">2000.0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mf">2000.0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"variables"</span><span class="p">:</span><span class="w"> </span><span class="mi">529</span><span class="p">,</span><span class="w">
        </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">530</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="fragments">Fragments</h4>

<h5 id="table">Table</h5>

<h5 id="state">State</h5>

<h5 id="exclusion">Exclusion</h5>

<p><code class="prettyprint">/datasets/{id}/exclusion/</code></p>

<p>Exclusion filters allow you to drop rows of data without permanently deleting them.</p>

<p>GET on this resource returns a Shoji Entity with a filter &ldquo;expression&rdquo; attribute in its body. Rows that match the filter expression will be excluded from all views of the data.</p>

<p>PATCH the &ldquo;expression&rdquo; attribute to modify. An empty &ldquo;expression&rdquo; object, like <code class="prettyprint">{&quot;body&quot;: {&quot;expression&quot;: {}}}</code>, is equivalent to &ldquo;no exclusion&rdquo;, i.e. no rows are dropped.</p>

<h5 id="stream">Stream</h5>

<h5 id="main-deck">Main deck</h5>

<h4 id="catalogs">Catalogs</h4>

<h5 id="batches">Batches</h5>

<h5 id="filters">Filters</h5>

<h5 id="variables">Variables</h5>

<h5 id="actions">Actions</h5>

<h5 id="savepoints">Savepoints</h5>

<h5 id="weight-variables">Weight variables</h5>

<h5 id="joins">Joins</h5>

<h5 id="multitables">Multitables</h5>

<h5 id="comparisons">Comparisons</h5>

<h5 id="forks">Forks</h5>

<h5 id="decks">Decks</h5>

<h5 id="permissions">Permissions</h5>

          <h2 id="variables">Variables</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{?relative,nosubvars}</code></p>

<p>A Shoji Catalog of variables.</p>

<h4 id="get-catalog">GET catalog</h4>

<p>When authenticated and authorized to view the given dataset, GET returns 200 status with a Shoji Catalog of variables in the dataset. If authorization is lacking, response will instead be 404.</p>

<p>Private variables are not included in the index of this catalog, although entities may be present at <code class="prettyprint">variables/{id}/</code>. See Private Variables for an index of those.</p>

<p>Catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>More machine-friendly, traditional name for a variable</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional longer string</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Immutable internal identifier</td>
</tr>
<tr>
<td>discarded</td>
<td>boolean</td>
<td>Whether the variable should be hidden from most views; default: false</td>
</tr>
<tr>
<td>derived</td>
<td>boolean</td>
<td>Whether the variable is a function of another; default: false</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>The string type name, one of &ldquo;numeric&rdquo;, &ldquo;text&rdquo;, &ldquo;categorical&rdquo;, &ldquo;datetime&rdquo;, &ldquo;categorical_array&rdquo;, or &ldquo;multiple_response&rdquo;</td>
</tr>
<tr>
<td>subvariables</td>
<td>array of URLs</td>
<td>For arrays, array of (ordered) references to subvariables</td>
</tr>
<tr>
<td>subvariables_catalog</td>
<td>URL</td>
<td>For arrays, link to a Shoji Catalog of subvariables</td>
</tr>
</tbody></table>

<p>The catalog has two optional query parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relative</td>
<td>string</td>
<td>If &ldquo;on&rdquo;, all URLs in the &ldquo;index&rdquo; will be relative to the catalog&rsquo;s &ldquo;self&rdquo;</td>
</tr>
<tr>
<td>nosubvars</td>
<td>integer</td>
<td>If 1, array subvariables will not be included directly in the variables catalog. Their metadata are instead accessible in each array variable&rsquo;s &ldquo;subvariables_catalog&rdquo;.</td>
</tr>
</tbody></table>

<p>With both flags enabled, the variable catalog looks something like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5330a0/variables/hier/"</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="p">,</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"weights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/weights/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"search"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/search/?q={token}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/specifications/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Variables of this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"a77d9f/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Birth Year"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthyear"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a77d9f"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"In what year were you born?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"qccomments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9e4c84"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you have any comments on your experience of taking this survey (optional)?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"aad4ad/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"subvariables_catalog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad/subvariables/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An Array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arrayvar"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"439dcf/"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"1c99ea/"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="err">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch-catalog">PATCH catalog</h4>

<p>Use PATCH to edit the &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;alias&rdquo;, or &ldquo;discarded&rdquo; state of one or more variables. A successful request returns a 204 response. The attributes changed will be seen by all users with access to this dataset; i.e., names, descriptions, aliases, and discarded state are not merely attributes of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset being modified, as shown in the &ldquo;permissions&rdquo; object in the dataset&rsquo;s catalog tuple. If you try to PATCH and are not authorized, you will receive a 403 response and no changes will be made.</p>

<p>The tuple attributes other than &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;alias&rdquo;, and &ldquo;discarded&rdquo; cannot be modified here by PATCH. Attempting to modify other attributes, or including new attributes, will return a 400 response. Variable &ldquo;type&rdquo; can only be modified by the &ldquo;cast&rdquo; method, described below. The &ldquo;subvariables&rdquo; can be modified by PATCH on the variable entity. &ldquo;subvariables_catalog&rdquo; is a URL to a different variable catalog and is thus not editable, though you can navigate to its location and modify subvariable attributes there. A variable&rsquo;s &ldquo;id&rdquo; and its &ldquo;derived&rdquo; state are immutable.</p>

<p>When PATCHing, you may include only the keys in each tuple that are being modified, or you may send the complete tuple. As long as the keys that cannot be modified via PATCH here are not modified, the request will succeed.</p>

<p>Note that, because this catalog contains its entities (rather than collecting them), you cannot PATCH to add new variables, nor can you PATCH a null tuple to delete them. Attempting either will return a 400 response. Creating variables is allowed only by POST to the catalog, while deleting variables is accomplished via a DELETE on the variable entity.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCHing this payload on the above catalog will return a 204 status. A subsequent GET of the catalog returns the following response; note the change in line 24.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5330a0/variables/hier/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"weights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/weights/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"search"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/variables/search/?q={token}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/specifications/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Variables of this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"a77d9f/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Birth Year"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthyear"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a77d9f"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"In what year were you born?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"qccomments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9e4c84"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you have any comments on your experience of taking this survey (optional)?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"aad4ad/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"subvariables_catalog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad/subvariables/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An Array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arrayvar"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"439dcf/"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"1c99ea/"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
    </span><span class="err">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post-catalog">POST catalog</h4>

<p>A POST to this resource must be a Shoji Entity with the following &ldquo;body&rdquo; attributes:</p>

<ul>
<li><strong>name</strong></li>
<li><strong>type</strong></li>
<li>(If &ldquo;type&rdquo; is &ldquo;categorical&rdquo;, &ldquo;multiple_response&rdquo;, or &ldquo;categorical_array&rdquo;): <strong>categories</strong>: an array of category definitions</li>
<li>If &ldquo;type&rdquo; is &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo;: <strong>subvariables</strong>: an array of either URLs of variables to be &ldquo;bound&rdquo; together to form the array variable, or partial variable definitions, which will be created as categorical variables and then bound to form the array. If including partial variable definitions, the array definition must include &ldquo;categories&rdquo;, which are shared among the subvariables</li>
<li>If type is &ldquo;multiple_response&rdquo;, the definition may include <strong>selected_categories</strong>: an array of category names present in the subvariables. This will mark the specified category or categories as the &ldquo;selected&rdquo; response in the multiple response variable. If no &ldquo;selected_categories&rdquo; array is provided, the new variable will use any categories already flagged as &ldquo;selected&rdquo;: true. If no such category exists, the response will return a 400 status.</li>
<li>If &ldquo;type&rdquo; is &ldquo;datetime&rdquo;: <strong>resolution</strong>: a string, such as &ldquo;Y&rdquo;, &ldquo;M&rdquo;, &ldquo;D&rdquo;, &ldquo;h&rdquo;, &ldquo;m&rdquo;, &ldquo;s&rdquo;, &ldquo;ms&rdquo;, that indicates the unit size of the datetime data.</li>
</ul>

<p>See Variable Definitions for more details and examples of valid attributes, and Feature Guide: Arrays for more information on the various cases for creating array variables.</p>

<p>It is encouraged, but not required, to include an &ldquo;alias&rdquo; in the body. If omitted, one will be generated from the required &ldquo;name&rdquo;.</p>

<p>You may also include &ldquo;values&rdquo;, which will create the column of data corresponding to this variable definition. See <a href="#column-by-column">Importing Data: Column-by-column</a> for details and examples.</p>

<p>You may instead also include an &ldquo;expr&rdquo; to derive a variable as a function of other variables. In this case, &ldquo;type&rdquo; is not required because it depends on the output of the specified derivation function. For details and examples, see <a href="#deriving-variables">Deriving Variables</a>.</p>

<p>A 201 indicates success and includes the URL of the newly-created variable in the Location header.</p>

<h4 id="private-variables-catalog">Private variables catalog</h4>

<p><code class="prettyprint">/datasets/{id}/variables/private/{?relative,nosubvars}</code></p>

<p><code class="prettyprint">GET</code> returns a Shoji Catalog of variables, as described above, containing those variables that are private to the authenticated user. You may <code class="prettyprint">PATCH</code> this catalog to edit names, aliases, descriptions, etc. of the private variables. <code class="prettyprint">POST</code>, however, is not supported at this endpoint. To create new private variables, <code class="prettyprint">POST</code> to the main variables catalog with a <code class="prettyprint">&quot;private&quot;: true</code> body attribute.</p>

<h3 id="hierarchical-order">Hierarchical Order</h3>

<p><code class="prettyprint">/datasets/{id}/variables/hier/</code></p>

<h4 id="get">GET</h4>

<p>Returns a Shoji Order.</p>

<h4 id="patch">PATCH</h4>

<p>Will expect a Shoji Order representation containing a replacement or new grouped entities. This allows one to create new groups on the fly or overwrite existing groups with new &lsquo;entities&rsquo;.</p>

<p>The match happens by each group name and will overwrite the values of each group with the received one.</p>

<p>After PATCH any variable not present in the order will always be appended to the root of the graph.</p>

<h4 id="put">PUT</h4>

<p>Receives a Shoji Order representation with a completely new graph. Any previously existing group will be eliminated and any new groups will be added. This will overwrite the complete set of current groups.</p>

<p>After PUT any variable not present on any of the groups will always be appended to the root of the graph.</p>

<h3 id="weights">Weights</h3>

<p><code class="prettyprint">/datasets/{id}/variables/weights/</code></p>

<p>GET a &ldquo;groups&rdquo; view with a single group named <code class="prettyprint">weight_variables</code> that contains the urls of the variables that have been designated as possible weight variables.</p>

<p>PATCH the <code class="prettyprint">value</code> with a &ldquo;groups&rdquo; body. The URLs on the payload (that aren&rsquo;t weight variables already) will be appended to the existing list of weight variables.</p>

<p>PUT the <code class="prettyprint">value</code> with a &ldquo;groups&rdquo; view. The value will overwrite the current weight variables with the incoming ones. Use this to delete weight variables.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weight_variables"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://beta.crunch.io/api/datasets/42d0a3/variables/42229f"</span><span class="p">]</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<aside class="warning">
It is only possible to submit variables that belong to the main dataset. That is, variables from joined datasets cannot be set as weight.
</aside>

<h3 id="search">Search</h3>

<p><code class="prettyprint">/datasets/{id}/variables/search/{?q}</code></p>

<p>On GET will return a Crunch Order with the variables matching the <code class="prettyprint">q</code> token in the URL. The results will be under the &ldquo;Search Results&rdquo; group containing the urls for the matching variables.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/4e9a00/variables/search/?q=something"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Returns a view with a group containing all the variables that match the given query"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/4e9a00/variables/b66668/"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/4e9a00/variables/8f68ca/"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/4e9a00/variables/f6ae03/"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/4e9a00/variables/b4bd6a/"</span><span class="p">,</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Search Results"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/</code></p>

<p>A Shoji Entity which exposes most of the metadata about a Variable in the dataset.</p>

<h4 id="get">GET</h4>

<p>Variable entities&rsquo; <code class="prettyprint">body</code> attributes contain the following:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>More machine-friendly, traditional name for a variable</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional longer string</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Immutable internal identifier</td>
</tr>
<tr>
<td>discarded</td>
<td>boolean</td>
<td>Whether the variable should be hidden from most views; default: false</td>
</tr>
<tr>
<td>private</td>
<td>boolean</td>
<td>If true, the Variable is only visible to the owner and is only included in the private variables catalog, not the common catalog.</td>
</tr>
<tr>
<td>derived</td>
<td>boolean</td>
<td>Whether the variable is a function of another; default: false</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>The string type name</td>
</tr>
<tr>
<td>categories</td>
<td>array</td>
<td>If &ldquo;type&rdquo; is &ldquo;categorical&rdquo;, &ldquo;multiple_response&rdquo;, or &ldquo;categorical_array&rdquo;, an array of category definitions (see below). Other types have an empty array.</td>
</tr>
<tr>
<td>subvariables</td>
<td>array of URLs</td>
<td>For arrays, array of (ordered) references to subvariables</td>
</tr>
<tr>
<td>derivation</td>
<td>object</td>
<td>For derived variables, a Crunch expression which was used to derive this variable; or null.</td>
</tr>
<tr>
<td>format</td>
<td>object</td>
<td>An object with various members to control the display of Variable data (see below)</td>
</tr>
<tr>
<td>view</td>
<td>object</td>
<td>An object with various members to control the display of Variable data</td>
</tr>
<tr>
<td>dataset_id</td>
<td>string</td>
<td>The id of the Dataset to which this Variable belongs.</td>
</tr>
<tr>
<td>missing_reasons</td>
<td>object</td>
<td>An object whose keys are reason phrases and whose values are missing codes. Missing entries in Variable data are represented by a {&ldquo;?&rdquo;: code} missing marker; clients may look up the corresponding reason phrase for each code in this one-to-one map.</td>
</tr>
</tbody></table>

<p>Category objects have the following members:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>identifier for the category, corresponding to values in the column of data</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>A unique label identifying the category</td>
</tr>
<tr>
<td>numeric_value</td>
<td>numeric</td>
<td>A quantity assigned to this category for numeric aggregation. May be <code class="prettyprint">null</code>.</td>
</tr>
<tr>
<td>missing</td>
<td>boolean</td>
<td>If true, the given category is marked as &ldquo;missing&rdquo;, and is omitted from most calculations.</td>
</tr>
<tr>
<td>selected</td>
<td>boolean</td>
<td>For categories in multiple response variables, those with <code class="prettyprint">&quot;selected&quot;: true</code> which values correspond to the &ldquo;response&rdquo; being selected. If omitted, the category is treated as not selected. Multiple response variables must have at least one category marked as selected and may have more than one.</td>
</tr>
</tbody></table>

<aside class="notice">
For variables with categories, you can get the &ldquo;missing reasons&rdquo; from the category definitions. You don&rsquo;t need the &ldquo;missing_reasons&rdquo; body attribute.
</aside>

<p>Format objects may contain:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>object</td>
<td>An object with an integer &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point when showing data values.</td>
</tr>
<tr>
<td>summary</td>
<td>object</td>
<td>An object with an integer &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point when showing aggregates values.</td>
</tr>
</tbody></table>

<p>View objects may contain:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>show_codes</td>
<td>boolean</td>
<td>For categorical types only. If true, numeric values are shown.</td>
</tr>
<tr>
<td>show_counts</td>
<td>boolean</td>
<td>If true, show counts; if false, show percents.</td>
</tr>
<tr>
<td>include_missing</td>
<td>boolean</td>
<td>For categorical types only. If true, include missing categories.</td>
</tr>
<tr>
<td>include_noneoftheabove</td>
<td>boolean</td>
<td>For multiple response types only. If true, display a &ldquo;none of the above&rdquo; category in the requested summary or analysis.</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p>PATCH variable entities to edit their metadata. Send a Shoji Entity with a &ldquo;body&rdquo; member containing the attributes to modify. Omitted body attributes will be unchanged.</p>

<p>Successful requests return 204 status. Among the actions achievable by PATCHing variable entities:</p>

<ul>
<li>Editing category attributes and adding categories. Include all categories.</li>
<li>Remove categories by sending all categories except for the ones you wish to remove. You can only remove categories that don&rsquo;t have any corresponding data values. Attempting to remove categories that have data associated will fail with a 400 response status.</li>
<li>Reordering subvariables in an array. Unlike categories, subvariables cannot be added or removed via PATCH here.</li>
<li>Editing derivation expressions</li>
<li>Editing format and view settings</li>
</ul>

<p>Actions that are best or only achieved elsewhere include:</p>

<ul>
<li>changing variable names, aliases, and descriptions, which is best accomplished by PATCHing the variable catalog, as described above;</li>
<li>changing a variable&rsquo;s type, which can only be done by POSTing to the variable&rsquo;s &ldquo;cast&rdquo; resource (see <a href="#convert-type">Convert type</a> below);</li>
<li>editing names, aliases, and descriptions of subvariables in an array, which is done by PATCHing the variable&rsquo;s subvariable catalog;</li>
<li>altering missing rules.</li>
</ul>

<p>Variable &ldquo;id&rdquo; and &ldquo;dataset_id&rdquo; are immutable.</p>

<h4 id="delete">DELETE</h4>

<p>Calling DELETE on this resource will delete the variable. On success, <code class="prettyprint">DELETE</code> returns 200 status with a Shoji View. When deleting array variables, this response value will contain the URLs of the (formerly sub-)variables, which are promoted to regular variables on <code class="prettyprint">DELETE</code> of the array. That is, deleting an array &ldquo;unbinds&rdquo; the subvariables, and to delete the array fully, one must then make a <code class="prettyprint">DELETE</code> request on each of the returned URLs.</p>

<p>For non-array variables, this View will be an empty array.</p>

<h3 id="summary">Summary</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/summary/{?filter}</code></p>

<p>A collection of summary information describing the variable. A successful GET returns an object containing various scalars and tabular results in various formats. The set of included members varies by variable type. Exclusions, filters, and weights may all alter the output.</p>

<p>For example, given a numeric variable with data [1, 2, 3, 4, 5, 4, {&ldquo;?&rdquo;: -1}, 3, 5, {&ldquo;?&rdquo;: -1}, 4, 3], a successful GET with no exclusions, filters, or weights returns:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nt">"valid_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fivenum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.25"</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.5"</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.75"</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">],</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"missing_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"min"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"median"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"histogram"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"stddev"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2649110640673518</span><span class="p">,</span><span class="w">
    </span><span class="nt">"max"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.4</span><span class="p">,</span><span class="w">
    </span><span class="nt">"missing_frequencies"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">}],</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<h4 id="numeric">numeric</h4>

<p>The members include several counts:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>missing_frequencies: An array of row objects. Each row represents a distinct missing reason, and includes the reason phrase as the &ldquo;value&rdquo; member and the number of entries which are missing for that reason as the &ldquo;count&rdquo; member.</li>
<li>histogram: An array of row objects. Each row represents a discrete interval in the probability distribution, whose boundaries are given by the &ldquo;bins&rdquo; pair. An &ldquo;at&rdquo; member is included giving the midpoint between the two boundaries. The &ldquo;value&rdquo; member gives a count of entries which fall into the given bin.
as well as basic summary statistics:</li>
<li>fivenum: An array of five [quartile, point] pairs, where the &ldquo;quartile&rdquo; element is one of the strings &ldquo;0&rdquo;, &ldquo;0.25&rdquo;, &ldquo;0.5&rdquo;, &ldquo;0.75&rdquo;, &ldquo;1&rdquo;, representing the min, first quartile, median, third quartile, and max boundaries to divide the data values into four equal groups. The &ldquo;point&rdquo; is the real number at each boundary, and is estimated using the same algorithm as Excel or R&rsquo;s &ldquo;algorithm 7&rdquo;, where h is: (N - 1)p + 1.</li>
<li>min, median, max: taken from &ldquo;fivenum&rdquo;, above.</li>
<li>mean: the sum of the values divided by the number of values, or, if weighted, the sum of weight times value divided by the sum of the weights.</li>
<li>stddev: The standard deviation of the values.</li>
</ul>

<h4 id="categorical">categorical</h4>

<p>The basic counts are included:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>missing_frequencies: An array of row objects. Each row represents a distinct missing reason, and includes the reason phrase as the &ldquo;value&rdquo; member. The number of entries which are missing for that reason is included as the &ldquo;count&rdquo; member.</li>
</ul>

<p>And the typical &ldquo;frequencies&rdquo; member is expanded into a custom &ldquo;categories&rdquo; member:</p>

<ul>
<li>categories: An array of row objects. Each row represents a distinct category (whether valid or missing), and includes its id the <code class="prettyprint">_id</code> member (note the leading underscore), and its name as the &ldquo;name&rdquo; member. The &ldquo;missing&rdquo; member is true or false depending on whether the category is marked missing or not. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
</ul>

<h4 id="text">text</h4>

<p>The basic counts are included:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>frequencies: An array of row objects. Each row represents a distinct valid value, and includes it as the &ldquo;value&rdquo; member. The number of entries which possess that value is included as the &ldquo;count&rdquo; member. The length of the array is limited to 10 entries; if more than 10 distinct values are present in the data, an 11th row is added with a &ldquo;value&rdquo; member of &ldquo;(Others)&rdquo;, summing their counts.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>missing_frequencies: An array of row objects. Each row represents a distinct missing reason, and includes the reason phrase as the &ldquo;value&rdquo; member. The number of entries which are missing for that reason is included as the &ldquo;count&rdquo; member.</li>
<li>nunique: The number of distinct values in the data.</li>
</ul>

<p>In addition:</p>

<ul>
<li>max_chars: The number of characters of the longest value in the data.</li>
</ul>

<h4 id="univariate-frequencies">Univariate frequencies</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/frequencies/{?filter,exclude_exclusion_filter}</code></p>

<p>An array of row objects, giving the count of distinct values. The exact members vary by type:</p>

<ul>
<li>numeric: Each row represents a distinct valid value, and includes it as the &ldquo;value&rdquo; member. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
<li>categorical: Each row represents a distinct category (whether valid or missing), and includes its id the <code class="prettyprint">_id</code> member (note the leading underscore), and its name as the &ldquo;name&rdquo; member. The &ldquo;missing&rdquo; member is true or false depending on whether the category is marked missing or not. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
<li>text: Each row represents a distinct valid value, and includes it as the &ldquo;value&rdquo; member. The number of entries which possess that value is included as the &ldquo;count&rdquo; member. The length of the array is limited to 10 entries; if more than 10 distinct values are present in the data, an 11th row is added with a &ldquo;value&rdquo; member of &ldquo;(Others)&rdquo;, summing their counts.</li>
</ul>

<h3 id="transforming">Transforming</h3>

<h4 id="convert-type">Convert type</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/cast/</code></p>

<p>A POST to this resource, with a JSON request body of {&ldquo;cast_as&rdquo;: type}, will alter the variable to the given type. If the variable cannot be cast to the given type, 409 is returned. See next to obtain a preview summary of such a cast before committing to it.</p>

<h5 id="casting-to-datetime">Casting to datetime</h5>

<ul>
<li>From Numeric: Need to include keys: <code class="prettyprint">offset</code> as an ISO-8601 date string and <code class="prettyprint">resolution</code> which is one of the following strings:

<ul>
<li>Y: Year</li>
<li>Q: Quarter</li>
<li>M: Month</li>
<li>W: Week</li>
<li>D: Day</li>
<li>h: Hour</li>
<li>m: Minutes</li>
</ul></li>
<li>From Text: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string to format with.</li>
<li>From Categorical: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string to format with.</li>
</ul>

<h5 id="casting-from-datetime">Casting from datetime</h5>

<ul>
<li>To Numeric: Not supported</li>
<li>To Text: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string that matches the variable values to parse with.</li>
<li>To Categorical: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string that matches the category names to parse with.</li>
</ul>

<h5 id="array-variables">Array variables</h5>

<ul>
<li>Multiple Response: Not supported</li>
<li>Categorical Array: Not supported</li>
</ul>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/cast/?cast_as={type}</code></p>

<p>A GET on this resource will return the same response as ../summary would if the variable were cast to the given type. If the given type is not valid, 404 is returned.</p>

<h3 id="attributes">Attributes</h3>

<h4 id="missing-values">Missing values</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/missing_rules/</code></p>

<p>A Shoji Entity whose &ldquo;body&rdquo; member contains an array of missing rule objects. POST a {reason: rule} to this URL to add a new rule. Rules take one of the following forms:</p>

<ul>
<li>{&#39;value&rsquo;: v}: Entries which match the given value will be marked as missing for the given reason.</li>
<li>{&#39;set&rsquo;: [v1, v2, &hellip;]}: Entries which are present in the given set will be marked as missing for the given reason.</li>
<li>{&#39;range&rsquo;: [lower, upper], &#39;inclusive&rsquo;: [true, false]}: Entries which exist between the given boundaries will be marked as missing for the given reason. If either &ldquo;inclusive&rdquo; element is null, the corresponding boundary is unbounded.</li>
<li>{&#39;function&rsquo;: &rsquo;&hellip;&rsquo;, &#39;args&rsquo;: [&hellip;]}: Entries which match the given filter function will be marked as missing for the given reason. This is typically a tree of simple rules logical-OR&rsquo;d together.</li>
</ul>

<p>Example:</p>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"Invalid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w">
    </span><span class="nt">"Sarai doesn't know how to use a calculator :("</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">],</span><span class="w"> </span><span class="nt">"inclusive"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">]},</span><span class="w">
  </span><span class="err">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h4 id="subvariables">Subvariables</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/subvariables/</code></p>

<h5 id="get">GET</h5>

<p>This endpoint will return 404 for any variable that is not an array variable (Multiple response and Categorical variable).</p>

<p>For array variables, this endpoint will return a Shoji Catalog containing a variables catalog with tuples for the subvariables. The tuples will have the same shape as the main variables catalog.</p>

<h5 id="patch">PATCH</h5>

<p>On PATCH, this endpoint allows modification to the variables attributes exposed on the tuples (name, description, alias, discarded).</p>

<p>It is possible to add new subvariables to the array variable in question. To do so include the URL of another variable (currently existing on the dataset) on the payload with an empty tuple and such variable will be converted into a subvariable and added at the end.</p>

<h4 id="values">Values</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/values/{?start,total,filter}</code></p>

<p>A GET on this set of resources will return a JSON array of values from the variable&rsquo;s data. Numeric variables will return numbers, text variables will return strings, and categorical variables will return category names for valid categories and {&ldquo;?&rdquo;: code} missing markers for missing categories. The &ldquo;start&rdquo; and &ldquo;total&rdquo; parameters paginate the results. The &ldquo;filter&rdquo; is a Crunch filter expression.</p>

<h3 id="private-variables">Private Variables</h3>

<p><code class="prettyprint">/datasets/{id}/variables/private/</code></p>

<p>Private variables are variables that, instead of being shared with everyone, are viewable only by the user that created them. In Crunch, users with view-only permissions on a dataset can still make variables of their own–just as they can make private filters.</p>

<p>Private variables are not shown in the common variable catalog. Instead, they have their own Shoji Catalog of private variables belonging to the specified dataset for the authenticated user. Aside from this separate catalog, private variable entities and the catalog behave just as described above for public variables.</p>

          <h2 id="filters">Filters</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/filters/</code></p>

<p>GET on this resource returns a Shoji Catalog with the list of Filters that the
current user can use on this Dataset.</p>

<p>This index contains two kinds of filters: public and private, denoted by the <code class="prettyprint">is_public</code> tuple attribute. Private filters are those created by the authenticated user, and they cannot be accessed by other users. Public filters are available to all users who are authorized to view the dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My filter"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1442EA..."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/{owner_id}/"</span><span class="p">,</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<p>The only tuple attribute editable via PATCHing the catalog is the &ldquo;name&rdquo;. A 204 response indicates a successful PATCH. Attempting to PATCH any other attribute will
return a 400 response.</p>

<p>POST a Shoji Entity to this catalog to create a new filter. Entities must include a <code class="prettyprint">name</code> and an
<code class="prettyprint">expression</code>. If omitted, <code class="prettyprint">is_public</code> defaults to False. A successful POST yields a 201 response
that will contain a Location header with the URL of the newly created filter.</p>

<p>All users with access to the dataset can create private filters; however, only the current dataset editor can create public filters (<code class="prettyprint">is_public: true</code>). Attempting to create a public filter when not the current dataset editor results in a 403 response.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/filters/{id}/</code></p>

<p>GET this resource to return a Shoji Entity containing the requested filter.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ac64ef"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8c6c9e3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master__tip"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Filter name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"last_update"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-12-31"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCH an entity to edit its <code class="prettyprint">expression</code>, <code class="prettyprint">name</code> or <code class="prettyprint">is_public</code> attributes. Successful PATCH requests return 204 status. As with the POSTing new entities to the catalog, only the dataset&rsquo;s current editor can alter <code class="prettyprint">is_public</code>.</p>

<p>The <code class="prettyprint">expression</code> attribute must contain a valid Crunch filter expression.</p>

<!-- Discuss valid crunch filter expressions -->

<p>See <a href="#expressions">expressions</a> in the Object Reference for more details.</p>

<h3 id="applied-filters">Applied filters</h3>

<p><code class="prettyprint">/datasets/{id}/filters/applied/</code></p>

<p>A Shoji order containing the filters applied by the current user.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://beta.crunch.io/api/datasets/ac64ef/filters/applied/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"http://beta.crunch.io/api/datasets/ac64ef/filters/28ef72/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://beta.crunch.io/api/datasets/ac64ef/filters/0ac6e1/"</span><span class="p">,</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="filtering-endpoints">Filtering endpoints</h3>

<p>Some endpoints will support filtering, they will accept a <code class="prettyprint">filter</code> GET parameter
that should be a JSON encoded object that can contain either the URL of a filter
(available through the Filters catalog) or a filter expression.</p>

<p>To filter using a filter URL, pass the following JSON object as the <code class="prettyprint">filter</code>
parameter:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://....."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=%7B%22filter%22%3A+%22http%3A%2F%2F...crunch.io%2Fdatasets%2Fid%2Ffilters%2Fid%2F%22%7D</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>To filter using a filter expression, pass the following JSON object as the
<code class="prettyprint">filter</code> parameter:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">".."</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="err">....</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=%7B%22expression%22%3A+%7B%22function%22%3A+%22%3D%3D%22%2C+%22args%22%3A+%5B%7B%22variable%22%3A+%22id%22%7D%2C+%7B%22value%22%3A+%22xx%22%7D%5D%7D%7D</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

          <h2 id="analyses">Analyses</h2>

          <h2 id="comparisons">Comparisons</h2>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/comparisons/{id}/</code></p>

<p>A Shoji Entity with the following &ldquo;body&rdquo; attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>bases</td>
<td>array of cube input objects</td>
<td>one for each analysis to which the comparison applies</td>
</tr>
<tr>
<td>overlay</td>
<td>cube</td>
<td>input object defining the comparison data</td>
</tr>
</tbody></table>

<p>See the Feature Guide for a discussion of the cube objects. POST one to the catalog (see below) to create a new comparison. GET to retrieve the complete Entity. PUT a new one to replace it. PATCH a subset of the attributes as desired. DELETE to remove the comparison.</p>

<p>The Entity also includes a &ldquo;cube&rdquo; link in its &ldquo;catalogs&rdquo; object; a GET on this link returns the output of the overlay cube. See &ldquo;Cube&rdquo; next.</p>

<h4 id="cube">Cube</h4>

<p><code class="prettyprint">/datasets/{id}/comparisons/{id}/cube/</code></p>

<p>A GET on this endpoint returns the output of the &ldquo;overlay&rdquo; cube query for the given comparison. The response will be a Crunch Cube with &ldquo;dimensions&rdquo; and &ldquo;measures&rdquo; members.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/comparisons/</code></p>

<p>A Shoji Catalog of comparison entities associated to the specified dataset.</p>

<h4 id="get-catalog">GET catalog</h4>

<p>When authenticated and authorized to view the given dataset, GET returns 200 status with a Shoji Catalog of the dataset&rsquo;s comparisons. If authorization is lacking, response will instead be 404.</p>

<p>Catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>bases</td>
<td>array of cube input objects</td>
<td>References to the dimensions and measures for which the comparison is valid</td>
</tr>
<tr>
<td>cube</td>
<td>URL</td>
<td>Link to generate the comparison data</td>
</tr>
</tbody></table>

<p>The catalog looks something like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/5ee0a0/comparisons/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/specifications/comparisons/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of the comparisons for this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"491fe3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All actors"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/0f7378/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/8451cb/"</span><span class="p">}],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
            </span><span class="p">}],</span><span class="w">
            </span><span class="nt">"cube"</span><span class="p">:</span><span class="w"> </span><span class="s2">"491fe3/cube/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9942ce/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Awareness: sector average"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/bf31fc/"</span><span class="p">}],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
            </span><span class="p">}],</span><span class="w">
            </span><span class="nt">"cube"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9942ce/cube/"</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch-catalog">PATCH catalog</h4>

<p>Use PATCH to edit the &ldquo;name&rdquo; and/or &ldquo;bases&rdquo; of one or more comparisons. A successful request returns a 204 response. </p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset, as shown in the &ldquo;permissions&rdquo; object in the dataset&rsquo;s catalog tuple. If you try to PATCH and are not authorized, you will receive a 403 response and no changes will be made.</p>

<p>Because this catalog contains its entities rather than collecting them, do not PATCH to add or delete comparisons. POST to the catalog to create new comparisons, and DELETE individual comparison entities.</p>

<h4 id="post-catalog">POST catalog</h4>

<p>Use POST to add a new comparison entity to the catalog. A 201 indicates success and includes the URL of the newly-created comparison in the Location header.</p>

          <h2 id="versions">Versions</h2>

<p>Datasets have a collection of versions, points in time to which you can roll back. </p>

<h3 id="catalog">Catalog</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/savepoints/?limit,skip</code></p>

<p>When authenticated, GET returns 200 status with a (paginated) Shoji Catalog of versions to which the dataset can be reverted. Catalog tuples contain the following attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_display_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>The name of the user who saved this version</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td></td>
<td>An informative note about the version, as in a commit message</td>
</tr>
<tr>
<td>version</td>
<td>string</td>
<td></td>
<td>An internal identifier for the saved version</td>
</tr>
<tr>
<td>last_update</td>
<td>datetime</td>
<td></td>
<td>Timestamp for when the version was created</td>
</tr>
<tr>
<td>revert</td>
<td>url</td>
<td></td>
<td>URL to POST to in order to roll back to this version. See below.</td>
</tr>
</tbody></table>

<p>Query parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>integer</td>
<td>10</td>
<td>How many versions to include in the catalog response</td>
</tr>
<tr>
<td>skip</td>
<td>integer</td>
<td>0</td>
<td>How many versions to skip before returning <code class="prettyprint">limit</code> versions</td>
</tr>
</tbody></table>

<p>For pagination purposes, catalog tuples are sorted from most to least recent. However, since JSON objects are unordered, you cannot rely on the order of the tuples within the payload you receive.</p>

<h4 id="post">POST</h4>

<p><code class="prettyprint">POST /datasets/{dataset_id}/savepoints/</code></p>

<p>To create a new version, POST a JSON object to the versions catalog. Object attributes may contain: </p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>description</td>
<td>string</td>
<td>No</td>
<td>An informative note about the version, as in a commit message</td>
</tr>
</tbody></table>

<p>A successful POST will return 201 status with the URL of the newly created version entity in the Location header. If the current user is not an editor of the dataset, POSTing will return a 403 status. </p>

<h4 id="patch">PATCH</h4>

<p>No version attributes may be modified by PATCHing the catalog. PATCH will return a 405 status. </p>

<h3 id="entity">Entity</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/savepoints/{version_id}/</code></p>

<p>Version entities expose a subset of attributes found in the catalog tuples:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_display_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>The name of the user who saved this version</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td></td>
<td>An informative note about the version, as in a commit message</td>
</tr>
<tr>
<td>version</td>
<td>string</td>
<td></td>
<td>An internal identifier for the saved version</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p><code class="prettyprint">PATCH /datasets/{dataset_id}/savepoints/{version_id}/</code></p>

<p>The version&rsquo;s &ldquo;description&rdquo; may be modified by PATCHing its entity. A successful request returns 204 status. If the current user is not an editor of the dataset, PATCHing will return a 403 status. </p>

<h3 id="reverting">Reverting</h3>

<p><code class="prettyprint">POST /datasets/{dataset_id}/savepoints/{version_id}/revert/</code></p>

<p>To roll back to a saved version, POST an empty body to the version&rsquo;s &ldquo;revert&rdquo; URL, found both inside the catalog tuple and in the &ldquo;views&rdquo; attribute of the entity. A successful request will return 204 status.</p>

          <h2 id="batches">Batches</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/batches/</code></p>

<p>A GET on this resource returns a Shoji Catalog enumerating the batches present in the Dataset. Each tuple in the index includes a &ldquo;status&rdquo; member, which may be one of &ldquo;analyzing&rdquo;, &ldquo;conflict&rdquo;, &ldquo;error&rdquo;, &ldquo;importing&rdquo;, &ldquo;imported&rdquo;, or &ldquo;appended&rdquo;.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...datasets/837498a/batches/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"0/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"appended"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"importing"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A POST to this resource adds a new batch. The payload can be be a Crunch Table (with variable metadata, row data, or both), the URI of a Source, or the URI of another dataset (provided that the authenticated user has view permissions). All added rows regardless of source obtain the same batch id. A 201 indicates success, and returns the URL of the new batch in the Location header.</p>

<p>If the append operation takes more than two minutes, 202 is returned instead and the batch will continue being appended in the background. The Location header is still returned, pointing to the new batch&rsquo;s URL. The client can GET that URL to query its status.</p>

<p>Batches are created in <code class="prettyprint">analyzing</code> status and will be advanced through <code class="prettyprint">importing</code>, <code class="prettyprint">imported</code>, and <code class="prettyprint">appended</code> status if there are no problems. If there was a problem in processing it, its status will be <code class="prettyprint">conflict</code> or <code class="prettyprint">error</code>.</p>

<p>Note that the status code will always be 202 for asynchronous or 201 for synchronous creation of the batch whether there were conflicts or not. So you need to GET the new batch&rsquo;s URL to see if the data is good to go (status <code class="prettyprint">appended</code>).</p>

<h4 id="appending-a-dataset">Appending a dataset</h4>

<p>Must contain the URL of a dataset that the current user can read. This action will create a Source entity mapping to such dataset. Its name and description will match the dataset&rsquo;s name and description respectively at that moment.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="appending-a-source">Appending a source</h4>

<p>Must contain the URL of a source that a user can read.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="appending-a-crunch-table">Appending a Crunch Table</h4>

<p>The variables IDs must match those of the target dataset since their types will be matched based on ID. The data is expected to match the target dataset&rsquo;s variable types. This action will create a new Source entity, its name and description will match those provided on the JSON response, if not provided they&rsquo;ll default to empty string.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:table"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;optional string&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;optional string&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"var_url_1"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">],</span><span class="w">
      </span><span class="nt">"var_url_2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/batches/{id}/</code></p>

<p>A GET on this resource returns a Shoji Entity describing the batch, and a link to its Crunch Table (see next).</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"conflicts"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"source_children"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"target_children"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">

    </span><span class="nt">"source_columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source_rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">235490</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target_columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">3499</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target_rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"appended"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="the-conflicts-object">The conflicts object</h4>

<p>Each batch has a &ldquo;conflicts&rdquo; member. Its value is an object that describes the conflicts found on each variable. It consists on an object keyed by variable ID. The value for each of these variables is as follows:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{}],</span><span class="w">
    </span><span class="err">}</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;id of the matching variable in the source frame"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source_metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name, etc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"as above"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"conflicts"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"resolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;optional string&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each element will contain four members: <code class="prettyprint">metadata</code> which will hold information of the variable on the target dataset (unless it is a variable that only exists on the source dataset), <code class="prettyprint">source_id</code> and <code class="prettyprint">source_metadata</code>, which describe the corresponding variable in the source frame (if any), and a <code class="prettyprint">conflicts</code> member.</p>

<p>The <code class="prettyprint">conflicts</code> member will contain an array with a list of individual conflicts that indicate what situations were found during batch preparation. This array will be empty if there were no conflicts.</p>

<p>Each of these conflicts can be either resolved or not, this is determined by the presence of the &ldquo;resolution&rdquo; key. Those conflicts without it are unresolved and until all those have a resolution, the batch in general will remain in status <code class="prettyprint">conflict</code>.</p>

<h4 id="table">Table</h4>

<p><code class="prettyprint">/datasets/{id}/batches/{id}/table/{?offset,limit}</code></p>

<p>A GET returns the rows of data from the Dataset for the identified batch as a Crunch Table.</p>

          <h2 id="sources">Sources</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/sources/</code></p>

<p>A Shoji Catalog representing the Sources added by this User. POST a multipart form here, with an &ldquo;uploaded_file&rdquo; field containing the file to upload; 201 indicates success, and the returned Location header refers to the new Source resource.</p>

<p>The uploaded sources will use the file&rsquo;s filename as their .name attribute and will have blank description.</p>

<p>The catalog will include the sources&rsquo; .name and .description</p>

<p>Alternately, you may POST a urlencoded payload with a <code class="prettyprint">source_url</code> parameter that points to a publicly accessible URL. Both &ldquo;http&rdquo; and the &ldquo;s3&rdquo; scheme are supported. This endpoint will then download such file synchronously and verify that it is a valid source file. It will be made available for the current user sources catalog.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/sources/{id}/</code></p>

<p>A Shoji Entity representing a single Source. Its &ldquo;body&rdquo; member contains:</p>

<ul>
<li>name: A friendly name for the Source.</li>
<li>type: a string declaring the media type of the source. One of (&ldquo;csv&rdquo;, &ldquo;spss&rdquo;).</li>
<li>user_id: the id of the User who created the Source.</li>
<li>location: an absolute URI to the data. Currently, the only supported scheme is &ldquo;crunchfile://&rdquo;, which indicates a file uploaded to Crunch.io.</li>
<li>settings: an object containing configuration for translating the source to crunch internals. Its members vary by type:

<ul>
<li>csv:

<ul>
<li>strict: an integer. If 1, extra columns or undefined category ids in the CSV will raise an error. If 0, they will be added to the dataset.</li>
</ul></li>
</ul></li>
</ul>

<p>A PUT must contain a JSON object with members from the Shoji Entity &ldquo;body&rdquo; which the client intends to update. 204 indicates success.</p>

<p>A DELETE destroys the Source resource. 204 indicates success.</p>

<p><code class="prettyprint">/sources/{id}/file/</code></p>

<p>A GET returns the original source file.</p>

          <h2 id="joins">Joins</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/joins/</code></p>

<p>A GET on this resource returns a Shoji Catalog enumerating the joins present in the Dataset. Each tuple in the index includes a &ldquo;left_key&rdquo; and a &ldquo;right_key&rdquo; member, each of which MUST be a variable URI. The left_key MUST be a variable in the current dataset, and the right_key SHOULD be a variable in another dataset. Both variables MUST be unique, and should be values taken from the same domain. For example, you might have a principal dataset which is a survey, with a respondent_id variable as a unique key. If you join a separate demographic dataset that has a unique column of the same respondent ids, you might see:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...datasets/837498a/joins/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"...datasets/837498a/joins/demo/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"left_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...datasets/837498a/variables/1ef71d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"right_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...datasets/de3095/variables/19471d/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A PATCH to this resource may add joins (by including new index members), alter existing joins (by replacing existing index members), or deleting joins (by setting existing members to null). A 204 indicates success. As with any Shoji Catalog, the URI of each entity in the index is the key.</p>

<p>Variables in joined datasets may then be used in analyses as if they were part of the principal dataset, simply by using their URI in this join&rsquo;s variables catalog (see below). The joined dataset includes one row for each row in the principal dataset, by taking the key in the principal and looking up the corresponding key and row in the subordinate dataset. Rows in the principal which have no corresponding row in the subordinate are filled with the &ldquo;No Data&rdquo; missing value.</p>

<p>In order to create or alter a new join, the logged user will need to have reading access to the right dataset otherwise the server will respond with a 400 error.</p>

<p>The variable url sent for the left key must be a valid url for the current dataset. It is not allowed to use a different dataset as a left table.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/joins/{id}/</code></p>

<p>A GET on this resource returns a Shoji Entity describing the join, and a link to its Crunch Table (see next). Currently, the Join entity only contains the batch_id for its frame, and therefore isn&rsquo;t very useful for clients. The entity resource is not editable; PATCH the joins catalog instead.</p>

<h3 id="joined-variables-catalog">Joined variables catalog</h3>

<p><code class="prettyprint">/datasets/{id}/joins/{id}/variables/</code></p>

<p>A variables catalog which describes variables in the subordinate dataset. See Variables for more details.</p>

          <h2 id="permissions">Permissions</h2>

<p>Authorization to view, edit, and manage a dataset is controlled by the dataset&rsquo;s permissions catalog:</p>

<p><code class="prettyprint">/datasets/{id}/permissions/</code></p>

<p>The permissions catalog is a Shoji Catalog that collects (not contains) Users. There are no permission &ldquo;entities&rdquo; to retrieve, create, or delete: all action is achieved directly on the permissions catalog.</p>

<h3 id="get-catalog">GET Catalog</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/1/permissions/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lists all the users that have access to this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/42/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"add_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_owner"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lauren Ipsum"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lipsum@crunch.io"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If authorized to view the dataset, a successful GET returns a Shoji Catalog indicating the users who have access to this dataset and their respective permissions. This includes the current, authorized user making the request. Index tuples are keyed by User URL. </p>

<p>Tuple values include:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the user</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Email address of the user</td>
</tr>
<tr>
<td>is_owner</td>
<td>boolean</td>
<td>Whether this user is the dataset&rsquo;s &ldquo;owner&rdquo;</td>
</tr>
<tr>
<td>dataset_permissions</td>
<td>object</td>
<td>Attributes governing the user&rsquo;s authorization. See below.</td>
</tr>
</tbody></table>

<p>Supported <code class="prettyprint">dataset_permissions</code>, all boolean, are:</p>

<ul>
<li><strong>view</strong>: Whether the user can view the dataset. Note that &ldquo;viewing&rdquo; is not limited to just GET requests, for dataset viewers may create filters, private variables, and saved analyses, for example.</li>
<li><strong>edit</strong>: Whether the user can edit the dataset. When editing, users with this permission may modify the common data of a dataset, including things like public filters available to all viewers of the dataset.</li>
<li><strong>add_users</strong>: Whether the user may share this dataset with others. Specifically, they may PATCH the catalog with references to users not already included in the catalog.</li>
<li><strong>change_permissions</strong>: Whether the user may alter other users&rsquo; authorization on this dataset, i.e., PATCH tuples for users that already exist on the catalog.</li>
</ul>

<h3 id="patch-catalog">PATCH Catalog</h3>

<p>The PATCH verb is used to make all modifications to dataset authorization: modifying existing permissions, revoking permissions for users with access, and granting access to users. </p>

<h4 id="modify-existing">Modify existing</h4>

<p>To change the permissions a user has, PATCH new dataset_permissions, like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"https://beta.crunch.io/api/users/42/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="err">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...,</span><span class="w">
    </span><span class="nt">"send_notification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/dataset/1"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Only the &ldquo;dataset_permissions&rdquo; key in the tuple can be modified by PATCHing this catalog. Other keys, such as &ldquo;name&rdquo;, are included only for facilitating human-readable display of the catalog. If sent, these other keys will be ignored. To modify users&rsquo; names, see users.</p>

<p>If a subset of dataset_permissions are included in the payload, only the specified permissions will have their values updated. Omitted permissions will remain unchanged.</p>

<p>Multiple users&rsquo; permissions can be modified in a single request by including multiple tuples keyed by User URL. </p>

<p>The &ldquo;send_notification&rdquo; key in the payload is optional; if included and True, the server will send an email invitation to all newly added users (see below), as well as to users who are granted &ldquo;edit&rdquo; privileges. </p>

<p>If &ldquo;send_notification&rdquo; is included and true, you may also include a &ldquo;dataset_url&rdquo;, which is the URL that will be included in the email notifying the users that they now have access to the dataset. The web application will send the &ldquo;browse&rdquo; view URL, for example, so that when the user receives the email notification, the link they follow will take them to the relevant dataset. If &ldquo;send_notification&rdquo; is true and &ldquo;dataset_url&rdquo; is omitted, the email link will default to https://beta.crunch.io/.</p>

<h4 id="add-new-user-from-within-account">Add new user from within account</h4>

<p>To add a user (i.e. share with them), there are two cases. First, if the user to be added is a member of the current user&rsquo;s account, PATCH similar to above, using this user&rsquo;s URL as key:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"/users/id/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"applied_filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">

        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<p>This payload may include a &ldquo;profile&rdquo; member, which are initial values with which to populate the sharee&rsquo;s user-dataset-profile. </p>

<p>Valid &ldquo;profile&rdquo; members include:</p>

<ul>
<li><strong>weight</strong>: a URL to one of the dataset&rsquo;s weight variables; if omitted, the sharer&rsquo;s current weight variable will be used</li>
<li><strong>applied_filters</strong>: an array of filter URLs which are shared with all dataset viewers. If any of the specified filters are private, the PATCH request will return 400 status. Default value for &ldquo;applied_filters&rdquo; is [].</li>
</ul>

<p>If the &ldquo;profile&rdquo; member is not included, the newly shared users will be created with their user dataset preferences matching the sharer&rsquo;s current weight.</p>

<h4 id="revoking-access">Revoking access</h4>

<p>To revoke users&rsquo; access to this dataset (aka &ldquo;unshare&rdquo; with them), PATCH a null tuple for their user URLs:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"/users/id/"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<p>Note that all of these PATCHes for add/edit/remove access to the dataset can be done in a single request that combines them all. </p>

<h4 id="validation">Validation</h4>

<p>The server will insist, and clients should also validate, that</p>

<ul>
<li>There is one and only one user with edit: true privileges for a dataset; if not, the PATCH request will return 400.</li>
<li>The users who are receiving new authorization via PATCH must have corresponding dataset_permissions on their account authorization. For example, the user who is updated to have edit: true has a dataset_permission of edit: true on their account authorization. If not, the PATCH request will return 400.</li>
<li>The user that is PATCHing this catalog must have share: true for this dataset; if not, the PATCH request will return 403.</li>
</ul>

<h4 id="inviting-new-users">Inviting new users</h4>

<p>It is possible to share a dataset with people that are not users of Crunch yet. To do so, it is necessary to send in an email address instead of a user URL as a sharing key.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"somebody@email.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="err">bool</span><span class="p">,</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="err">/*</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"weight"</span><span class="p">:,</span><span class="w"> 
            </span><span class="nt">"applied_filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="err">}</span><span class="w">
        </span><span class="err">*/</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"send_notifications"</span><span class="err">,</span><span class="w"> </span><span class="err">true,</span><span class="w">
    </span><span class="nt">"url_base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/password/change/${token}/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/dataset/1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A new user with such email address will be created and added to the account of the user that is making the request. The new user will receive an invitation email to Crunch.io with an activation link. In case the user exists on other or the same account, no changes to the user will be made.</p>

<p>If &ldquo;send_notification&rdquo; was included and true in the request, the user will receive a notification email informing her about the new shared dataset if requested so. New users, unless they have an OAuth provider specified, will need to set a password, and the client application should send a URL template that directs them to a place where they can set that password. To do so, include a &ldquo;url_base&rdquo; attribute in the payload, a URL template with a <code class="prettyprint">${token}</code> variable into which the server will insert the password-setting token. For the Crunch web application, this template is <code class="prettyprint">https://beta.crunch.io/password/change/${token}/</code>.</p>

<aside class="success">
    You may not know whether the email address you&rsquo;re sharing with already has a Crunch account. To be safe, you can always include &ldquo;url_base&rdquo; whenever you include `&ldquo;send_notifications&rdquo;: true`. If it&rsquo;s needed, your invitees will thank you. If it&rsquo;s not needed, it will be ignored.
</aside>

<aside class="notice">
    If you share with a new user and don&rsquo;t include `&ldquo;send_notifications&rdquo;: true`, they won&rsquo;t receive an email inviting them to set a password for their new Crunch account. That&rsquo;s okay, though: they can always go to the web application and click &ldquo;Forgot password&rdquo; to send a new password reset token. 
</aside>

          <h2 id="users">Users</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/users/{?email,id}</code></p>

<p>A successful GET on this resource returns a Shoji Catalog whose &ldquo;index&rdquo; URL&rsquo;s refer to User objects. If the &ldquo;email&rdquo; or &ldquo;id&rdquo; parameters are provided, the result is narrowed to Users matching those parameters.</p>

<p>This method only supports GET requests. To add users they need to be added from each account users&rsquo; catalog. This endpoint ensures that the new users belong to an account and get an invitation accordingly.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/users/{id}/{?reason_url}</code></p>

<p>A Shoji Entity with the following body members:
first_name
last_name
id
email
id_method (optional)
id_provider (optional, and only if id_method == &lsquo;oauth&rsquo;)</p>

<p>If the current user has the &ldquo;alter_users&rdquo; account permission, or is the viewed user, a hefty set of associated URL&rsquo;s is included. Otherwise, the current user must have the &ldquo;view&rdquo; permission for the viewed user, or receives 403 Forbidden.</p>

<p>The id_method member can be one of {&#39;oauth&rsquo;, &#39;pwhash&rsquo;}. If not present, &#39;pwhash&rsquo; is assumed.</p>

<p>Any user can PUT new attributes via a JSON-like request body. A 200 indicates success.</p>

<p><code class="prettyprint">/users/{id}/invite/</code></p>

<p>A POST to this resource sends an invitation from the current user to the identified User. A 204 indicates success. The current user must have &ldquo;can_alter_users&rdquo; account permission or 403 is returned instead.</p>

<p>If a &ldquo;url_base&rdquo; parameter is included in the request body, it will be used to form links inside the invitation.</p>

<p><code class="prettyprint">/users/{id}/password/</code></p>

<p>A POST on this resource must consist of a JSON object with the members &ldquo;old_pw&rdquo; and &ldquo;new_pw&rdquo;. A 204 indicates success.</p>

<p><code class="prettyprint">/users/{id}/password_reset/</code></p>

<p>A GET on this resource always returns 204. A POST will send a reset password notification to the identified user. A 204 indicates success.</p>

<p>If a &ldquo;url_base&rdquo; parameter is included in the request body, it will be used to form links inside the notification.</p>

          <h2 id="teams">Teams</h2>

<p>Teams contain references to users and datasets. By sharing a dataset with a team, you can grant access to a set of users at once, and by adding a user to a team, you can grant them access to a set of datasets.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/teams/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight plaintext"><code>// Example team catalog:
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of all the teams where the current user is member"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/teams/d07edb/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The A-Team"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/teams/67fe89/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Palo Alto Data Science"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="n">teams</span> <span class="o">&lt;-</span> <span class="n">getTeams</span><span class="p">()</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span>
<span class="c1">## [1] "The A-Team" "Palo Alto Data Science"
</span></code></pre>

<h4 id="post">POST</h4>

<p>To create a new team, POST a Shoji Entity with a team &ldquo;name&rdquo; in the body. No other attributes are required, and you will be automatically assigned as the &ldquo;owner&rdquo;. </p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/teams/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "My new team with ytpo"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/teams/03df2a/</span>
</code></pre>
<pre class="highlight r"><code><span class="c1"># Create a new team by assigning into the teams catalog
</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"My new team with ytpo"</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">()</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span> <span class="c1"># Let's see that it was created
## [1] "The A-Team" "Palo Alto Data Science"
## [3] "My new team with ytpo"
</span>
<span class="c1"># You can also assign members to the team when you create it,
# even though the POST /teams/ API does not support it.
</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"New team with members"</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">(</span><span class="n">members</span><span class="o">=</span><span class="s2">"fake.user@example.com"</span><span class="p">)</span>
</code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/teams/{team_id}/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight plaintext"><code>// Example team entity
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Details for a specific team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The A-Team"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"datasets"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/datasets/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"members"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/members/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="c1"># Access a team by name using $ or [[ from the team catalog
</span><span class="n">a.team</span> <span class="o">&lt;-</span> <span class="n">teams</span><span class="p">[[</span><span class="s2">"The A-Team"</span><span class="p">]]</span>
<span class="n">name</span><span class="p">(</span><span class="n">a.team</span><span class="p">)</span>
<span class="c1">## [1] "The A-Team"
</span><span class="n">self</span><span class="p">(</span><span class="n">a.team</span><span class="p">)</span>
<span class="c1">## [1] "https://beta.crunch.io/api/teams/d07edb/"
</span></code></pre>

<p>A GET request on a team entity URL returns the same &ldquo;name&rdquo; and &ldquo;owner&rdquo; attributes as shown in the team catalog, as well as references to the &ldquo;datasets&rdquo; and &ldquo;members&rdquo; catalogs corresponding to the team. Authorization is required: if the requesting user is not a member of the team, a 404 response will result.</p>

<h4 id="patch">PATCH</h4>

<p>Team names are editable by PATCHing the team entity. Authorization is required: only the team owner may edit the team&rsquo;s name; other team members will receive a 403 response on PATCH.</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/03df2a/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "My new team without typo"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>
<pre class="highlight r"><code><span class="n">name</span><span class="p">(</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"My new team with ytpo"</span><span class="p">]])</span> <span class="o">&lt;-</span> <span class="s2">"My new team without typo"</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span> <span class="c1"># Check that it was updated
## [1] "The A-Team" "Palo Alto Data Science"
## [3] "My new team without typo"
</span></code></pre>

<h3 id="team-members-catalog">Team members catalog</h3>

<p><code class="prettyprint">/teams/{team_id}/members/</code></p>

<p>The team members catalog is a Shoji Catalog similar in nature to the <a href="#permissions">dataset permissions catalog</a>. It collects references to users and defines the authorizations they have with respect to the team. All information about the member relationships is contained in the catalog&ndash;there are no &ldquo;member entities&rdquo;&ndash;and all changes to team membership, whether adding, modifying, or removing users, is done via PATCH.</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="n">members</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
</code></pre>

<p>Tuple values include:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the user</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td>Attributes governing the user&rsquo;s authorization on the team.</td>
</tr>
</tbody></table>

<p>Supported <code class="prettyprint">permissions</code>, all boolean, include:</p>

<ul>
<li><strong>manage_members</strong>: Whether the user may add or remove users from the team, as well as modify the permissions of users on the team; i.e., PATCH the member catalog. Default is False, except for the team owner.</li>
</ul>

<h4 id="patch">PATCH</h4>

<p>Authorization is required: team members who do not have the &ldquo;manage_members&rdquo; permission and who attempt to PATCH the member catalog will receive a 403 response. As with the team entity, non-members will receive 404 on attempted PATCH.</p>

<p>PATCH a partial Shoji Catalog to add users to the team, to modify permissions of members already on the team, and to remove team members. The examples below illustrate each of those actions separately, but all can be done together in a single PATCH request, in fact. </p>

<p>In the &ldquo;index&rdquo; attribute of the catalog, object keys must be either (a) URLs of User entities or (b) email addresses. They can be mixed in a single PATCH request. Using email address allows you to invite a user to Crunch while adding them to the team if they do not yet have a Crunch account, but it is also valid as a reference to Users that already exist. </p>

<h5 id="add-and-modify-members">Add and modify members</h5>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:catalog",</span>
<span class="s">    "index": {</span>
<span class="s">        "https://beta.crunch.io/api/users/47193a/": {</span>
<span class="s">            "permissions": {</span>
<span class="s">                "manage_members": true</span>
<span class="s">            }</span>
<span class="s">        },</span>
<span class="s">        "https://beta.crunch.io/api/users/e3211a/": {},</span>
<span class="s">        "templeton.peck@army.gov": {</span>
<span class="s">            "permissions": {</span>
<span class="s">                "manage_members": true</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    },</span>
<span class="s">    "send_notification": true,</span>
<span class="s">    "url_base": "https://beta.crunch.io/password/change/${token}/"</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>

<p>If the index object keys correspond to users that already appear in the member catalog, their permissions will be updated with the corresponding value. In this example, user <code class="prettyprint">47193a</code>, B. A. Baracus, has been given the <code class="prettyprint">manage_members</code> permission.</p>

<p>If the index object keys do not correspond to users already found in the member catalog, the indicated users will be added to the team. And, if the indicated user, as specified by email address, does not yet exist, they will be invited to Crunch and added to the team. In this example, we added existing user <code class="prettyprint">e3211a</code>, implicitly with <code class="prettyprint">manage_members</code> set to False, to the team, and we also added &ldquo;templeton.peck@army.gov&rdquo;, who did not previously have a Crunch account. </p>

<p>If &ldquo;send_notification&rdquo; was included and true in the request, new-to-Crunch users will receive a notification email informing them that they have been invited to Crunch. New users, unless they have an OAuth provider specified, will need to set a password, and the client application should send a URL template that directs them to a place where they can set that password. To do so, include a &ldquo;url_base&rdquo; attribute in the payload, a URL template with a <code class="prettyprint">${token}</code> variable into which the server will insert the password-setting token. For the Crunch web application, this template is <code class="prettyprint">https://beta.crunch.io/password/change/${token}/</code>.</p>

<p>A GET on the members catalog shows the updated catalog.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/e3211a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Howling Mad Murdock"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/89eb3a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"templeton.peck@army.gov"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="removing-members">Removing members</h5>

<p>To remove members from the team, PATCH the catalog with a <code class="prettyprint">null</code> value:</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">```json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:catalog",</span>
<span class="s">    "index": {</span>
<span class="s">        "https://beta.crunch.io/api/users/e3211a/": null</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">beta.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/users/89eb3a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"templeton.peck@army.gov"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="team-datasets-catalog">Team datasets catalog</h3>

<p><code class="prettyprint">/teams/{team_id}/datasets/</code></p>

<p>The team datasets catalog only supports the GET verb. To add a dataset to a team, you must PATCH its <a href="#permissions">permissions catalog</a>. </p>

<h4 id="get">GET</h4>

<p>GET returns a Shoji Catalog of datasets that have been shared with this team. See <a href="#datasets">datasets</a> for details.</p>

          <h1 id="object-reference">Object Reference</h1>

<p>version 0.14</p>

<p>The Crunch REST API takes a decidedly column-oriented approach to data. A &ldquo;column&rdquo; is simply a sequence of values of the same type. A &ldquo;variable&rdquo; binds a name (and other metadata) to the column, and indeed may possess a series of columns over its lifetime as inserts and updates are made to it. A &ldquo;dataset&rdquo; is a set of variables. Each variable in the dataset is sorted the same way; the variables together form a relation. Reading the N&#39;th item from each variable produces a row.</p>

<p>Interaction with the Crunch REST API is by variables and columns. When you add data to Crunch, you send a set of columns. When you fetch data from Crunch, you send a set of variable expressions and receive a set of columns. When you update data in Crunch, you send a set of expressions which tells Crunch how to update variables with new column data.</p>

<p>The Crunch API consists of just a few primitive objects, arranged differently for each request and response. Learning the basic components will help you create the most complicated queries.</p>

<h2 id="statistical-data">Statistical data</h2>

<h3 id="identifiers">Identifiers</h3>

<p>Datasets, variables, and other resources are always identified by strings. All identifiers are case-sensitive, and may contain any unicode character, including spaces. Examples:</p>

<ul>
<li>&ldquo;q1&rdquo;</li>
<li>&ldquo;My really useful dataset&rdquo;</li>
<li>&ldquo;变量&rdquo;</li>
</ul>

<h3 id="data-values">Data Values</h3>

<p>Individual data values follow the JSON representations where possible. JSON exposes the following types: number, string, array, object, true, false, null. Crunch adds additional types with special syntax (see Types, below). Examples:</p>

<ul>
<li>13</li>
<li>45.330495</li>
<li>&ldquo;foo&rdquo;</li>
<li>[3, 4, 5]</li>
<li>{&ldquo;bar&rdquo;: {&ldquo;a&rdquo;: [12.4, 89.2, 0]}}</li>
<li>true</li>
<li>null</li>
<li>&ldquo;2014-03-02T14:29:59Z&rdquo;</li>
</ul>

<p>Because a single JSON type may be used to represent multiple Crunch types, you should never rely on the JSON type to interpret the class of a datum. Instead, inspect the type object (see below) to interpret the data.</p>

<h4 id="missing-values">Missing values</h4>

<p>Crunch provides a robust &ldquo;missing entries&rdquo; system. Anywhere a (valid) data value can appear, a missing value may also appear. Missing values are represented by an object with a single &ldquo;?&rdquo; key. The value is a missing integer code (see Missing reasons, below); negative integers are reserved for system-generated reasons, user-defined reasons are automatically assigned positive integers. Examples:</p>

<ul>
<li>{&ldquo;?&rdquo;: -1}</li>
<li>{&ldquo;?&rdquo;: 24}</li>
</ul>

<h4 id="arrays">Arrays</h4>

<p>A set of data values (and/or missing values) which are of the same type can be ordered in an array. All entries in an array are of the same Crunch type.</p>

<p>Examples:</p>

<ul>
<li>[13, 4, 5, {&ldquo;?&rdquo;: -2}, 7, 2]</li>
<li>[&ldquo;foo&rdquo;, &ldquo;bar&rdquo;]</li>
</ul>

<h4 id="enumerations">Enumerations</h4>

<p>Some arrays, rather than repeating a small set of large values, benefit from storing a small integer code instead, moving the larger values they represent into the metadata, and doing lookups when needed to encode/decode. The &ldquo;categorical&rdquo; type is the most common example of this: rather than store an array of large string names like [&ldquo;Internet Explorer&rdquo;, &ldquo;Internet Explorer&rdquo;, &ldquo;Firefox&rdquo;, &hellip;] it instead stores integer codes like: [1, 1, 2], placing the longer strings in the metadata as type.categories = [{&ldquo;id&rdquo;: 1, &ldquo;name&rdquo;: &ldquo;Internet Explorer&rdquo;, &hellip;}, &hellip;]. We call this encoding process enumeration, and its opposite, where the coded are re-expanded into their original values, elaboration.</p>

<p>Enumeration also provides the opportunity to order the possible values, as well as include potential values which do not yet exist in the data array itself.</p>

<p>Enumeration typically causes the volume of data to shrink dramatically, and can speed up very common operations like filtering, grouping, and almost any data transfer. Because of this, it is common to:</p>

<ul>
<li>Enumerate a data array as early as possible. Indeed, when a variable can be enumerated, the fastest way to insert new data is to send the new values as the integer codes.</li>
<li>Elaborate a data array as late as possible. As long as the metadata is shipped along with the enumerated data, the transfer size and therefore time is much smaller. Many cases do not even call for a complete elaboration of the entire column.</li>
</ul>

<h3 id="variable-definitions">Variable Definitions</h3>

<p>This section describes the metadata of a variable as exposed across HTTP, both expected response values and valid input values.</p>

<p>Crunch operates on the principle that analytic users proceed through a series of steps where they both refine existing data and transform existing variables into new variables. Therefore, it employs a structural type system, not a nominative one. Practically, this means that, although we may know the &ldquo;type&rdquo; of a variable (numeric, text, categorical, etc) even before data is input, we learn more about the metadata of a variable as time goes on. The variable definition therefore includes more knowledge than just the type name; we also learn details about range, precision, missing values and reasons, order, etc. Both definitions and types, therefore, are complete objects, not just names. For example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Party ID"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you consider yourself generally a Democrat, a Republican, or an Independent?"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Republican"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Democrat"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Independent"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="variable-types">Variable types</h4>

<p>The &ldquo;type&rdquo; of a Variable is a string which defines the superset of values from which the variable may draw. The type governs not only the set of values but also their syntax. (See below.)</p>

<p>The following types are defined for public use:</p>

<ul>
<li>text</li>
<li>numeric</li>
<li>categorical</li>
<li>datetime</li>
<li>multiple_response</li>
<li>categorical_array</li>
</ul>

<h4 id="variable-names">Variable names</h4>

<p>Crunch takes a principled stand that variable &ldquo;names&rdquo; should be for people, not for computers.</p>

<h5 id="name">name</h5>

<p>You may be used to domains that have variable &ldquo;name&rdquo;, &ldquo;label&rdquo;, and &ldquo;description&rdquo;. Name is some short, unique, machine-friendlier ID like &ldquo;Q2&rdquo;; label is short and human-friendly, something like &ldquo;Brand awareness&rdquo;, and description is where you might put question wording if you have survey data. Crunch has &ldquo;alias&rdquo;, &ldquo;name&rdquo;, and &ldquo;description&rdquo;. What you may be used to thinking of as a variable name, we consider as an alias: something for more internal use, not something appropriate for a polished dataset ready to share with people who didn&rsquo;t create the dataset (See more in the &ldquo;Alias&rdquo; section below). In Crunch, the variable&rsquo;s &ldquo;name&rdquo; is what you may be used to thinking of as a label.</p>

<p>All variables must have a name, and these names must be unique across all variables, including &ldquo;hidden&rdquo; variables (see below) but excluding subvariables (see &ldquo;Subvariables&rdquo; below). Within an array variable, subvariable names must be unique. (You can think of subvariable names within an array as being variable_name.subvariable_name, and with that approach, all &ldquo;variable names&rdquo; must be unique.)</p>

<p>Names must be a string of length greater than zero, and any valid unicode string is allowed. See &ldquo;Identifiers&rdquo; above.</p>

<h5 id="alias">alias</h5>

<p>Alias is a string identifier for variables. It must be unique across all variables, including subvariables, such that it can be used as an identifier. This is what legacy statistical software typically calls a variable name.</p>

<p>Aliases have several uses. Client applications, such as those exposing a scripting interface, may want to use aliases as a more machine-friendly, yet still human-readable, way of referencing variables. Aliases may also be used to help line up variables across different import batches.</p>

<p>When creating variables via the API, alias is not a required field; if omitted, an alias will be generated. If an alias is supplied, it must be unique across all variables, including subvariables, and the new variable request will be rejected if the alias is not unique. When data are imported from file formats that have unique variable names, those names will in many cases be used as the alias in Crunch.</p>

<h5 id="description">description</h5>

<p>Description is an optional string that provides more information about the variable. It is displayed in the web application on variable summary cards and with analyses.</p>

<h4 id="type-specific-attributes">Type-specific attributes</h4>

<p>These keys must be present for the specified variable types when creating a variable, but they are not defined for other types.</p>

<h5 id="categories">categories</h5>

<p>Categorical variables must contain an array of Category objects, each of which includes:</p>

<p>name: the string name which applications should use to identify the category.
numeric_value: the numeric value bound to each name. If no numeric value should be bound, this should be null.
id: a read-only integer identifier for the category. These correspond to the data values.
missing: boolean indicating whether this category should be interpreted as missing values.
selected: (optional) boolean indicating whether this category corresponds to a selected value for a dichotomized variable, i.e. part of a multiple response variable. Not required for regular categorical variables, and defaults to <code class="prettyprint">false</code> if omitted.</p>

<p>Categories are valid if:</p>

<ul>
<li>Category names are unique within the set</li>
<li>Category ids are unique within the set</li>
<li>Category ids for user-defined categories are nonnegative. Negative ids are reserved for system missing reasons. See &ldquo;missing_reasons&rdquo; below.</li>
</ul>

<p>numeric_values need not be unique. There also is no requirement for Categories in a dichotomized subvariable that only one Category be marked &ldquo;selected&rdquo;.</p>

<p>The order of the array defines the order of the categories, and thus the order in which aggregate data will be presented. This order can be changed by saving a reordered set of Categories.</p>

<h5 id="subvariables">subvariables</h5>

<p>Multiple Response and Categorical Array variables contain an array of subvariable references. In the HTTP API, these are presented as URLs. To create a variable of type &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo;, you must include a &ldquo;subvariables&rdquo; member with an array of variable references. These variables will become the subvariables in the new array variable.</p>

<p>Like Categories, the array of subvariables within an array variable indicate the order in which they are presented; to reorder them, save a modified array of subvariable references.</p>

<h5 id="resolution">resolution</h5>

<p>Datetime variables must have a resolution string that indicates the unit size of the datetime data. Valid values include &ldquo;Y&rdquo;, &ldquo;M&rdquo;, &ldquo;D&rdquo;, &ldquo;h&rdquo;, &ldquo;m&rdquo;, &ldquo;s&rdquo;, and &ldquo;ms&rdquo;. Every datetime variable must have a resolution.</p>

<h4 id="other-definition-attributes">Other definition attributes</h4>

<p>These attributes may be supplied on variable creation, and they are included in API responses unless otherwise noted.</p>

<h5 id="format">format</h5>

<p>An object with various members to control the display of Variable data:</p>

<ul>
<li>data: An object with a &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point.</li>
<li>summary: An object with a &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point.</li>
</ul>

<h5 id="view">view</h5>

<p>An object with various members to control the display of Variable data:</p>

<ul>
<li>show_codes: For categorical types only. If true, numeric values are shown.</li>
<li>show_counts: If true, show counts; if false, show percents.</li>
<li>include_missing: For categorical types only. If true, include missing categories.</li>
<li>column_width: For &ldquo;untyped&rdquo; Variables only. The selected display width of column data, in pixels, or None.</li>
<li>include_noneoftheabove: For multipleresponse types only. If true, display a &ldquo;none of the above&rdquo; category in the requested summary or analysis.</li>
</ul>

<h5 id="discarded">discarded</h5>

<p>Discarded is a boolean value indicating whether the variable should be viewed as part of the dataset. Hiding variables by setting discarded to True is like a soft, restorable delete method.</p>

<p>Default is &ldquo;False&rdquo;.</p>

<h5 id="private">private</h5>

<p>If True, the variable will not show in the common variable catalog; instead, it will be included in the private variables catalog. Such variables may have their ids included in the variable order.</p>

<h5 id="missing_reasons">missing_reasons</h5>

<p>An object whose keys are reason strings and whose values are the codes used for missing entries.</p>

<p>Crunch allows any entry in a column to be either a valid value or a missing code. Regardless of the class, missing codes are represented in the interface as an object with a single &ldquo;?&rdquo; key mapped to a single missing integer code. For example, a segment of [4.56, 9.23, {&ldquo;?&rdquo;: -1}] includes 2 valid values and 1 missing value.</p>

<p>The missing codes map to a reason phrase via this &ldquo;missing reasons&rdquo; type member. Entries which are missing for reasons determined by the system are negative integers. Users may define their own missing reasons, which receive positive integer codes. Zero is a reserved value.</p>

<p>In the above example, the code of -1 would be looked up in a missing reasons map such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"missing reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"no data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type mismatch"</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"my backup was corrupted"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>See the Endpoint Reference for user-defined missing reasons.</p>

<p>Categorical variables do not require a missing_reasons object because the categories array contains the information about missingness.</p>

<h4 id="values">Values</h4>

<p>When creating a new variable, one can also include a &ldquo;values&rdquo; member that contains the data column corresponding to the variable metadata. See Importing Data: Column-by-column. This subsection outlines how the various variable types have their values formatted both when one supplies values to add to the dataset and when one requests values from a dataset.</p>

<h5 id="text">Text</h5>

<p>Text values are an array of quoted strings. Missing values are indicated as <code class="prettyprint">{&quot;?&quot;: &lt;integer&gt;}</code>, as discussed above, and all integer missing value codes must be defined in the &ldquo;missing_reasons&rdquo; object of the variable&rsquo;s metadata.</p>

<h5 id="numeric">Numeric</h5>

<p>A &ldquo;numeric&rdquo; value will always be e.g. 500 (a number, without quotes) in the JSON request and response messages, not &ldquo;500&rdquo; (a string, with quotes). Missing values are handled as with text variables.</p>

<h5 id="categorical">Categorical</h5>

<p>Insert an array of integers that correspond to the ids of the variable&rsquo;s categories. Only integers found in the category ids are allowed. That is, you cannot insert values for which there is no category metadata. It is, however, permitted to have categories defined for which there are no values.</p>

<h5 id="datetime">Datetime</h5>

<p>Datetime input and output are in ISO-8601 formatted strings.</p>

<h5 id="arrays">Arrays</h5>

<p>Crunch supports array type variables, which contain an array of subvariables. &ldquo;Multiple response&rdquo; and &ldquo;Categorical array&rdquo; are both arrays of categorical variables. Subvariables that have been &ldquo;bound&rdquo; into arrays can be dealt with separately as well.</p>

<p>All statements about variables are also true for subvariables unless otherwise noted.</p>

<h5 id="multiple-response">Multiple Response</h5>

<p>Requesting multiple response values returns values that are each an array, the values of which are the subvariable names for which that row of the data has a value indicated as &ldquo;selected&rdquo;.</p>

<h5 id="categorical-array">Categorical Array</h5>

<p>Requesting categorical array values return values that are each an array, the values of which are the category names of the values for each subvariable. Each value in a categorical array is an array of equal length of the number of subvariables in the array.</p>

<h3 id="variables">Variables</h3>

<p>A complete Variable, then, is simply a Definition combined with its data array.</p>

<h3 id="expressions">Expressions</h3>

<p>Crunch expressions are used to compute on a dataset, to do nuanced selects, updates, and deletes, and to accomplish many other routine operations. Expressions are JSON objects in which each term is wrapped in an object which declares whether the term is a variable, a value, or a function, etc. While verbose, doing so allows us to be more explicit about the operations we wish to do.</p>

<p>Expressions generally contain references to <strong>variables</strong>, <strong>values</strong>, or <strong>columns</strong> of values, often composed in <strong>functions</strong>. The output of expressions can be other variables, values, boolean masks, or cube aggregations, depending on the context and expression content. Some endpoints have special semantics, but the general structure of the expressions follows the model described below.</p>

<h4 id="variable-terms">Variable terms</h4>

<p>Terms refer to variables when they include a &ldquo;variable&rdquo; member. The value is the URL for the desired variable. For example:</p>

<ul>
<li><code class="prettyprint">{&quot;variable&quot;: &quot;../variables/X/&quot;}</code></li>
<li><code class="prettyprint">{&quot;variable&quot;: &quot;https://beta.crunch.io/api/datasets/48ffc3/joins/abcd/variables/Y/&quot;}</code></li>
</ul>

<p>URLs must either be absolute or relative to the URL of the current request. For example, to refer to a variable in a query at <code class="prettyprint">https://beta.crunch.io/api/datasets/48ffc3/cube/</code>, a variable at <code class="prettyprint">https://beta.crunch.io/api/datasets/48ffc3/variables/9410fc/</code> may be referenced by its full URL or by &ldquo;../variables/9410fc/&rdquo;.</p>

<h4 id="value-terms">Value terms</h4>

<p>Terms refer to data values when they include a &ldquo;value&rdquo; member. Its value is any individual data value; that is, a value that is addressable by a column and row in the dataset. For example:</p>

<ul>
<li><code class="prettyprint">{&quot;value&quot;: 13}</code></li>
<li><code class="prettyprint">{&quot;value&quot;: [3, 4, 5]}</code></li>
</ul>

<p>Note that individual values may themselves be complex arrays or objects, depending on their type. You may explicitly include a &ldquo;type&rdquo; member in the object, or let Crunch infer the type. One way to do this is to use the &ldquo;typeof&rdquo; function to indicate that the value you&rsquo;re specifying corresponds to the exact type of an existing variable. See &ldquo;functions&rdquo; below for more details.</p>

<h4 id="column-terms">Column terms</h4>

<p>Terms refer to columns (construct them, actually) when they include a &ldquo;column&rdquo; member. The value is an array of data values. You may include &ldquo;type&rdquo; and/or &ldquo;references&rdquo; members as well.</p>

<ul>
<li><code class="prettyprint">{&quot;column&quot;: [1, 2, 3, 17]}</code></li>
<li><code class="prettyprint">{&quot;column&quot;: [{&quot;?&quot;: -2}, 1, 4, 1], &quot;type&quot;: {&quot;class&quot;: &quot;categorical&quot;, &quot;categories&quot;: [...], ...}}</code></li>
</ul>

<h4 id="function-terms">Function terms</h4>

<p>Terms refer to functions (and operators) when they include a &ldquo;function&rdquo; member. The value is the identifier for the desired function. They parameterize the function with an &ldquo;args&rdquo; member, whose value is an array of terms, one for each argument. Examples:</p>

<ul>
<li><code class="prettyprint">{&quot;function&quot;: &quot;==&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../variables/X/&quot;}, {&quot;value&quot;: 13}]}</code></li>
<li><code class="prettyprint">{&quot;function&quot;: &quot;contains&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../joins/abcd/variables/Y/&quot;}, {&quot;value&quot;: &quot;foo&quot;}]}</code></li>
</ul>

<p>You may include a &ldquo;references&rdquo; member to provide a name, alias, description, etc to the output of the function.</p>

<!-- 
##### Supported functions

LIST THEM -->

<!-- typeof -->

<h4 id="filter-terms">Filter terms</h4>

<p>Terms that refer to filters entities by URL are shorthand for the boolean expression stored in the entity. So, <code class="prettyprint">{&quot;filter&quot;: &quot;../filters/59fc4d/&quot;}</code> yields the Crunch expression contained in the Filter entity&rsquo;s &ldquo;expression&rdquo; attribute. Filter terms can be combined together with other expressions as well. For example, <code class="prettyprint">{&quot;function&quot;: &quot;and&quot;, &quot;args&quot;: [{&quot;filter&quot;: &quot;../filters/59fc4d/&quot;}, {&quot;function&quot;: &quot;==&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../variables/X/&quot;}, {&quot;value&quot;: 13}]}]}</code> would &ldquo;and&rdquo; together the boolean expression in filter 59fc4d with the <code class="prettyprint">X == 13</code> expression.</p>

<h2 id="documents">Documents</h2>

<h3 id="shoji">Shoji</h3>

<p>Most representations returned from the API are Shoji Documents. Shoji is a media type designed to foster scalable API&rsquo;s. Shoji is built with JSON, so any JSON parser should be able to at least deserialize Shoji documents. Shoji adds four document types: Entity, Catalog, View, and Order.</p>

<h4 id="entity">Entity</h4>

<p>Anything that can be thought of as &ldquo;a thing by itself&rdquo; will probably be represented by a Shoji Entity Document. Entities possess a &ldquo;body&rdquo; member: a JSON object where each key/value pair is an attribute name and value. For example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/1/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Details for a User."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/specifications/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fragments"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"address/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Genghis"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Khan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In general, an HTTP GET to the &ldquo;self&rdquo; URL will return the document, and a PUT of the same will update it. PUT should not be used for partial updates–use PATCH for that instead. In general, each member included in the &ldquo;body&rdquo; of a PATCH message will replace the current representation; attributes not included will not be altered. There is no facility to remove an attribute from an Entity.body via PATCH. In some cases, however, even finer-grained control is possible via PATCH; see the Endpoint Reference for details.</p>

<h4 id="catalog">Catalog</h4>

<p>Catalogs collect or contain entities. They act as an index to a collection, and indeed possess an &ldquo;index&rdquo; member for this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A list of all the users."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/specifications/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default_order/"</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
        </span><span class="nt">"1/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
        </span><span class="nt">"4/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
        </span><span class="nt">"3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each key in the index is a URL (possibly relative to &ldquo;self&rdquo;) which refers to a different resource. Often, these are Shoji Entity documents, but not always. The index also allows some attributes to be published as a set, rather than in each individual Entity. This allows clients to act on the collection as a whole, such as when rendering a list of references from which the user might select one entity.</p>

<p>In general, an HTTP GET to the &ldquo;self&rdquo; URL will return the document, and a PUT of the same will update it. Many catalogs allow POST to add a new entity to the collection. PUT should not be used for partial updates&ndash;use PATCH for that instead. In general, each member included in the &ldquo;index&rdquo; of a PATCH message will replace the current representation; tuples not included will not be altered. Tuples included in a PATCH which are not present in the server&rsquo;s current representation of the index may be added; it is up to each resource whether to support (and document!) this approach or prefer POST to add entities to the collection. In general, catalogs that <em>contain</em> entities get new entities created by POST, while catalogs that <em>collect</em> entities that are contained by other catalogs (e.g. a catalog of users who have permissions on a dataset) will have entities added by PATCH.</p>

<p>Similarly, removing entities from catalogs is supported in one of two ways, typically varying by catalog type. For catalogs that contain entities, entities are removed only by DELETE on the entity&rsquo;s URL (its key in the Catalog.index). In contrast, for catalogs that collect entities, entities are removed by PATCHing the catalog with a <code class="prettyprint">null</code> tuple. This removes the entity from the catalog but does not delete the entity (which is contained by a different catalog). T</p>

<h4 id="view">View</h4>

<p>Views cut across entities. They can publish nearly any arrangement of data, and are especially good for exposing arrays of arrays and the like. In general, a Shoji View is read-only, and only a GET will be successful.</p>

<h4 id="order">Order</h4>

<p>Orders can arrange any set of strings into an arbitrarily-nested tree; most often, they are used to provide one or more orderings of a Catalog&rsquo;s index. For example, each user may have their own ordering for an index of variables; the same URL&rsquo;s from the index keys are arranged in the Order. Given the Catalog above, for example, we might produce an Order like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/order/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"2/"</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="nt">"group A"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2/"</span><span class="p">]},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"group B"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"4/"</span><span class="p">]}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This represents the tree:</p>
<pre class="highlight plaintext"><code>      /  |  \
     2  {A} {B}
       / | \  \
      1  3  2  4
</code></pre>

<p>The Order object itself allows lots of flexibility. Each of the following decisions are up to the API endpoint to constrain or not as it sees fit (see the Endpoint Reference for these details):</p>

<ul>
<li>Not every string in the original set has to be present, allowing partial orders.</li>
<li>Strings from the original set which are not mentioned may be ignored, or default to an &ldquo;ungrouped&rdquo; group, or other behaviors as each application sees fit.</li>
<li>Groups may contain member strings and other groups interleaved (but still ordered).</li>
<li>Groups may exist without any members.</li>
<li>Members may appear in more than one group.</li>
<li>Group names may be repeated at different points within the tree.</li>
<li>Group member arrays, although represented in a JSON array, may be declared to be non-strict in their order (that is, the array should be treated more like an unordered set).</li>
</ul>

<h3 id="crunch-objects">Crunch Objects</h3>

<p>Most of the other representations returned from the API are Crunch Objects. They are built with JSON, so any JSON parser should be able to at least deserialize Crunch documents. Crunch adds two document types: Table and Cube.</p>

<h4 id="table">Table</h4>

<p>Tables collect columns of data and (optionally) their metadata into two-dimensional relations.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:table"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/datasets/.../table/?limit=7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The data belonging to this Dataset."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"1ef0455"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w">
        </span><span class="nt">"588392a"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Favorite color"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="s2">"data"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"1ef0455"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w">
        </span><span class="nt">"588392a"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"RED"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pink"</span><span class="p">,</span><span class="w"> </span><span class="s2">" red"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each key in the &ldquo;data&rdquo; member is a variable identifier, and its corresponding value is a column of Crunch data values. The data values in a given column are homogeneous, but across columns they are heterogeneous. The lengths of all columns MUST be the same. The &ldquo;metadata&rdquo; member is optional; if given, it MUST contain matching keys that correspond to variable definitions.</p>

<p>Like any JSON object, the &ldquo;data&rdquo; and &ldquo;metadata&rdquo; objects are explicitly unordered. When supplying a crunch:table, such as when POST&#39;ing to datasets/ to create a new dataset, you must supply an Order if you want an explicit variable order.</p>

<h4 id="cube">Cube</h4>

<p>Cubes have both input and output formats. The &ldquo;crunch:cube&rdquo; element is used for the output only.</p>

<h5 id="cube-input">Cube input</h5>

<p>The input format may vary slightly according to the API endpoint (since some parameters may be inherent in the particular resource), but involves the same basic ingredients.</p>

<p>Example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/3ffd45/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/2098f1/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}]}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h6 id="dimensions">dimensions</h6>

<p>An array of input expressions. Each expression contributes one dimension to the output cube. The only exception is when a dimension results in a boolean (true/false) column, in which case the data are filtered by it as a mask instead of adding a dimension to the output.</p>

<p>When a dimension is added, the resulting axis consists of distinct values rather than all values. Variables which are already &ldquo;categorical&rdquo; or &ldquo;enumerated&rdquo; will simply use their &ldquo;categories&rdquo; or &ldquo;elements&rdquo; as the extent. Other variables form their extents from their distinct values.</p>

<h6 id="measures">measures</h6>

<p>A set of cube functions to populate each cell of the cube. You can request multiple functions over the same dimensions (such as “cube_mean” and “cube_stddev”) or more commonly just one (like “cube_count”). Each member MUST be a ZZ9 cube function designed for the purpose. See ZZ9 User Guide:Cube Functions for a list of such functions and their arguments.</p>

<h6 id="filters">filters</h6>

<p>An array containing references to filters that need to be applied to the dataset before starting the cube calculations. It can be an empty array or null, in which case no filtering will be applied.</p>

<h6 id="weight">weight</h6>

<p>A reference to a variable to be used as the weight on all cube operations.</p>

<h5 id="cube-output">Cube output</h5>

<p>Cubes collect columns of measure data in an arbitrary number of dimensions. Multiple measures in the same cube share dimensions, effectively overlaying each other. For example, a cube might contain a &ldquo;count&rdquo; measure and a &ldquo;mean&rdquo; measure with the same shape:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">210</span><span class="p">,</span><span class="w">
    </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">]}},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">]}}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="nt">"integer"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">},</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">],</span><span class="w">
            </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">},</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">17.8</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">7.32</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">23.4</span><span class="p">],</span><span class="w">
            </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"margins"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">210</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">]},</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">]},</span><span class="w">
    </span><span class="err">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h6 id="dimensions">dimensions</h6>

<p>The &ldquo;dimensions&rdquo; member is the most straightforward: an array of variable Definition objects. Each one defines an axis of the cube&rsquo;s output. This may be different from the input dimensions&rsquo; definitions. For example, when counting numeric variables, the input dimension might be an expression involving the bin builtin function. Even though the input variable is of type &ldquo;numeric&rdquo;, the output dimension would be of type &ldquo;enum&rdquo; .</p>

<h6 id="n">n</h6>

<p>The number of rows considered for all measures.</p>

<h6 id="measures">measures</h6>

<p>The &ldquo;measures&rdquo; member includes one object for each measure. The &ldquo;metadata&rdquo; member of each tells you the name, type and other definitions of the measure. The &ldquo;data&rdquo; member of each is a flattened array of values for that measure; the dimensions stride into that array in order, with the last dimension varying the fastest. In the example above, the first dimension (&ldquo;A&rdquo;) has 3 categories, while &ldquo;B&rdquo; has 2; therefore, the &ldquo;flat&rdquo; array [10, 20, 30, 40, 50, 60] for the &ldquo;count&rdquo; measure is interpreted as the &ldquo;unflattened&rdquo; array [[10, 20], [30, 40], [50, 60]]. Graphically:</p>

<table><thead>
<tr>
<th></th>
<th>B:11</th>
<th>B:12</th>
</tr>
</thead><tbody>
<tr>
<td>A:1</td>
<td>10</td>
<td>20</td>
</tr>
<tr>
<td>A:2</td>
<td>30</td>
<td>40</td>
</tr>
<tr>
<td>A:3</td>
<td>50</td>
<td>60</td>
</tr>
</tbody></table>

<p>This is known in NumPy and other domains as &ldquo;C order&rdquo; (versus &ldquo;Fortran order&rdquo; which would be interpreted as [[10, 30, 50], [20, 40, 60]] instead).</p>

<h6 id="n_missing">n_missing</h6>

<p>The number of rows that are missing for this measure. Because different measures may have different inputs (the column to take the mean of, for example, or weighted versus unweighted), this number may vary from one measure to another even though the total &ldquo;n&rdquo; is the same for all.</p>

<h6 id="margins">margins</h6>

<p>The &ldquo;margins&rdquo; member is optional. When present, it is a tree of nested margins with one level of depth for each dimension. At the top, we always include the &ldquo;grand total&rdquo; for all dimensions. Then, we include a branch for each axis we &ldquo;unroll&rdquo;. So, for example, for a 3-dimensional cube of X, Y, and Z, the margins member might contain:</p>
<pre class="highlight json"><code><span class="s2">"margins"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4526</span><span class="p">],</span><span class="w">
    </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1755</span><span class="p">,</span><span class="w"> </span><span class="mi">2771</span><span class="p">],</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">601</span><span class="p">,</span><span class="w"> </span><span class="mi">370</span><span class="p">,</span><span class="w"> </span><span class="mi">322</span><span class="p">,</span><span class="w"> </span><span class="mi">269</span><span class="p">,</span><span class="w"> </span><span class="mi">147</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">332</span><span class="p">,</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="mi">596</span><span class="p">,</span><span class="w"> </span><span class="mi">523</span><span class="p">,</span><span class="w"> </span><span class="mi">437</span><span class="p">,</span><span class="w"> </span><span class="mi">668</span><span class="p">]</span><span class="w">
        </span><span class="p">]},</span><span class="w">
        </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mi">1198</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">1493</span><span class="p">,</span><span class="w"> </span><span class="mi">1278</span><span class="p">]]}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">933</span><span class="p">,</span><span class="w"> </span><span class="mi">585</span><span class="p">,</span><span class="w"> </span><span class="mi">918</span><span class="p">,</span><span class="w"> </span><span class="mi">792</span><span class="p">,</span><span class="w"> </span><span class="mi">584</span><span class="p">,</span><span class="w"> </span><span class="mi">714</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">601</span><span class="p">,</span><span class="w"> </span><span class="mi">370</span><span class="p">,</span><span class="w"> </span><span class="mi">322</span><span class="p">,</span><span class="w"> </span><span class="mi">269</span><span class="p">,</span><span class="w"> </span><span class="mi">147</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">332</span><span class="p">,</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="mi">596</span><span class="p">,</span><span class="w"> </span><span class="mi">523</span><span class="p">,</span><span class="w"> </span><span class="mi">437</span><span class="p">,</span><span class="w"> </span><span class="mi">668</span><span class="p">]</span><span class="w">
        </span><span class="p">]},</span><span class="w">
        </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">825</span><span class="p">,</span><span class="w"> </span><span class="mi">108</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">560</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="mi">593</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">417</span><span class="p">,</span><span class="w"> </span><span class="mi">375</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">191</span><span class="p">,</span><span class="w"> </span><span class="mi">393</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">373</span><span class="p">,</span><span class="w"> </span><span class="mi">341</span><span class="p">]</span><span class="w">
        </span><span class="p">]}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2691</span><span class="p">,</span><span class="w"> </span><span class="mi">1835</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mi">1198</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">1493</span><span class="p">,</span><span class="w"> </span><span class="mi">1278</span><span class="p">]]},</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">825</span><span class="p">,</span><span class="w"> </span><span class="mi">108</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">560</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="mi">593</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">417</span><span class="p">,</span><span class="w"> </span><span class="mi">375</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">191</span><span class="p">,</span><span class="w"> </span><span class="mi">393</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">373</span><span class="p">,</span><span class="w"> </span><span class="mi">341</span><span class="p">]</span><span class="w">
        </span><span class="p">]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Again, each branch in the tree is an axis we &ldquo;unroll&rdquo; from the grand total. So margins[0][2] contains the margin where X (axis 0) and Z (axis 2) are unrolled, and only Y (axis 1) is still &ldquo;rolled up&rdquo;.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">HTTP</a>
                <a href="#" data-language-name="shell">cURL</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="r">R</a>
          </div>
      </div>
    </div>
  </body>
</html>

## Projects

Projects are ....

They live under /projects/ and will list the projects that the authenticated user
is a member or owner of.

### Catalog

The projects catalog will list all the projects the authenticated user is a member of.
Here you can create new projects via POST

#### GET

```http
GET /projects/ HTTP/1.1
```

```json
{
  "element": "shoji:catalog",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/",
  "views": {
    "generate_icon": "http:\/\/local.crunch.io:8080\/api\/projects/generate_icon\/"
  },
  "index": {
    "http:\/\/local.crunch.io:8080\/api\/projects\/4643\/": {
      "name": "Project 1",
      "id": "4643",
      "icon": ""
    },
    "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/": {
      "name": "Project 2",
      "id": "6c01",
      "icon": "",
      "description": "Description of project 2"
    }
  }
}
```

Name | Type | Default | Description
-----|------|---------|-------------
name | string | | Required when creating the project
description | string | "" | Longer description pf tje [rpkect
id | string | autogenerated | The project's id
icon | url | "" | Url for the icon file for the project. Empty string if not set

#### POST

New projects need a name (no uniqueness enforced) and will make the authenticated
user its initial member and editor.

```http
POST /projects/ HTTP/1.1
```

Payload example:

```json
{
    "body": {
        "name": "My new project",
        "icon_url": "http://...",
    }
}
```

##### Creating a project with an icon

To create one with a starting icon you can POST an `icon_url` attribute 
indicating a url where to fetch that icon from (has to be a publicly accessible url).

If the server cannot read that URL the request will return a 409 error.

If not provided the API will pick an available icon from the icons catalog.

On success a copy of the file will be stored as the icon to be serve

#### Default icon

The API can provide default icons to be used in new projects. Performing a GET
request will return a Shoji:catalog with a list of available icons for the client
to pick.
 
 
```http
GET /projects/icons/ HTTP/1.1
```

```json
{
  "element": "shoji:catalog",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/icons\/",
  "index": {
    "http://....png": {},
    "http://....png": {},
    "http://....png": {}
  }
}
```


### Entity

#### GET

```http
GET /projects/abcd/ HTTP/1.1
```

```json
{
  "element": "shoji:entity",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/",
  "catalogs": {
    "datasets": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/datasets\/",
    "members": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/members\/"
  },
  "views": {
    "icon": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/icon\/"
  },
  "body": {
    "name": "Project 2",
    "description": "Long description text",
    "icon": "",
    "user_icon": false,
    "id": "",
  }
}
```

Name | Type | Default | Description
-----|------|---------|-------------
name | string | | Required when creating the project
description | string | "" | Longer description of the project
id | string | autogenerated | The project's id
icon | url | "" | Url for the icon file for the project. Empty string if not set
user_icon | boolean | autogenerated | Will indicate false if the icon used on creation is from the provided catalog

Note about the `icon` attribute that points to the actual image file where the
configured icon is. This url does not point to the `views.icon` Shoji view url.

The `views.icon` Shoji view endpoint is used to PUT the icon as a file upload
for this project.

#### DELETE

Deleting a project will *NOT* delete its datasets. It will change their 
ownership to the authenticated user.

```http
DELETE /projects/abcd/ HTTP/1.1
```

#### Projects order

Returns the `shoji:order` in which the projects should be displayed for
 the user. This entity is independent for each user.
 
As the user is added to more projects, these will be added at the end of the
`shoji:order`.
 
##### GET

Will return a `shoji:order` containing a flat list of all the projects where
the current user belongs to.


```http
GET /projects/order/ HTTP/1.1
```

```json
{
  "element": "shoji:order",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/order\/",
  "graph": [
    "https://beta.crunch.io/api/projects/cc9161/",
    "https://beta.crunch.io/api/projects/a598c7/"
  ]
}
```

##### PUT

In order to change the order of the projects, the client will need to PUT the
full payload back to the server.

The graph attribute should contain all projects included, else it will return
a 400 response.

After a successful PUT request, the server will reply with a 204 response.

```http
PUT /projects/order/ HTTP/1.1
```

```json
{
  "element": "shoji:order",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/order\/",
  "graph": [
    "https://beta.crunch.io/api/projects/cc9161/",
    "https://beta.crunch.io/api/projects/a598c7/"
  ]
}
```



#### Members

Use this endpoint to manage the users that have access to this project.

##### GET

Returns a catalog with all users that have access to this project in the 
following format:

```http
GET /projects/abcd/members/ HTTP/1.1
```

```json
{
  "element": "shoji:catalog",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/members\/",
  "index": {
    "http:\/\/local.crunch.io:8080\/api\/users\/00002\/": {
      "name": "Jean-Luc Picard",
      "email": "captain@crunch.io"
    },
    "http:\/\/local.crunch.io:8080\/api\/users\/00005\/": {
      "name": "William Riker",
      "email": "firstofficer@crunch.io",
      "permissions": {
        "edit: false,
        "view": true
      }
    }
  }
}
```


##### PATCH

Use this method to add or remove members from the project. Only project editors 
have this capabilities, else you will get a 403 response.

To add a new user, PATCH a catalog keyed by the new user URL and an empty
object for its value.

To remove users, PATCH a catalog keyed by the user you want to remove and `null`
for its value.

Note that you cannot remove yourself from the project, you will
get a 400 response.

It is possible to perform many additions/removals in one request, the 
following example adds users `/users/001/` and deletes users `/users/002/`


```http
PATCH /projects/abcd/members/ HTTP/1.1
```

```json
{
  "element": "shoji:catalog",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/members\/",
  "index": {
    "http:\/\/local.crunch.io:8080\/api\/users\/001\/": {},
    "http:\/\/local.crunch.io:8080\/api\/users\/002\/": null
  }
}
```


#### Datasets

Will list all the datasets that have this project as their owner.

##### Adding datasets to projects

The way to add a dataset to a project is by changing the dataset's owner to the
project you want.

You must have edit and be current editor on any given dataset to change its
owner and you must also have edit permissions on the target project.


##### GET

Will show the list of all datasets where this project is their owner, the 
shape of the dataset tuple will be the same as in other dataset catalogs.


```http
GET /projects/abcd/datasets/ HTTP/1.1
```

```json
{
  "element": "shoji:catalog",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/datasets\/",
  "orders": {
    "order": "http://local.crunch.io:8080/api/projects/6c01/datasets/order/"
  },
  "index": {
    "https://beta.crunch.io/api/datasets/cc9161/": {
        "owner_name": "James T. Kirk",
        "name": "The Voyage Home",
        "description": "Stardate 8390",
        "archived": false,
        "permissions": {
            "edit": false,
            "change_permissions":,
            "add_users":,
            "change_weight":,
            "view": true
        },
        "size": {
            "rows": 1234,
            "columns": 67
        },
        "id": "cc9161",
        "owner_id": "https://beta.crunch.io/api/users/685722/",
        "start_date": "2286",
        "end_date": null,
        "creation_time": "1986-11-26T12:05:00",
        "current_editor": "https://beta.crunch.io/api/users/ff9443/",
        "current_editor_name": "Leonard Nimoy"
    },
    "https://beta.crunch.io/api/datasets/a598c7/": {
        "owner_name": "Spock",
        "name": "The Wrath of Khan",
        "description": "",
        "archived": false,
        "permissions": {
            "edit": true,
            "change_permissions":,
            "add_users":,
            "change_weight":,
            "view": true
        },
        "size": {
            "rows": null,
            "columns": null
        },
        "id": "a598c7",
        "owner_id": "https://beta.crunch.io/api/users/af432c/",
        "start_date": "2285-10-03",
        "end_date": "2285-10-20",
        "creation_time": "1982-06-04T09:16:23.231045",
        "current_editor": null,
        "current_editor_name": null
    }
  }
}
```

#### Icon

The icon endpoint for a project is a ShojiView that allows to change the
project's icon.

##### GET

On GET, it will return a `shoji:view` with its value containing a url to the
icon file or empty string in case there isn't an icon for this project yet.

By default all new projects have an empty icon URL.


```http
GET /projects/abcd/icon/ HTTP/1.1
```


```json
{
  "element": "shoji:view",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/icon\/",
  "value": ""
}
```

##### PUT

PUT to this endpoint to change a project's icon. The payload should have the
 form of a standard multipart/form-data upload. The file's contents will be 
 stored and made available under the project's url.
 
Only the project's editors can change the project's icon.
 
Valid image extensions: 'png', 'gif', 'jpg', 'jpeg' - Others will 400

#### POST

Same as PUT


#### Datasets order

Contains the `shoji:order` in which the datasets of this project are to be 
ordered.

This is endpoint available for all project members but can only be updated by 
the project's editors.


##### GET

Will return the `shoji:order` response containing the datasets that belong
to the project.

```http
GET /projects/6c01/datasets/order/ HTTP/1.1
```

```json
{
  "element": "shoji:order",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/datasets\/order\/",
  "graph": [
    "https://beta.crunch.io/api/datasets/cc9161/",
    "https://beta.crunch.io/api/datasets/a598c7/"
  ]
}
```

##### PUT

Allow to make modifications to the `shoji:order` for the contained datasets.
Only the project's editors can make these changes.

Trying to include an invalid dataset or an incomplete list will return a 
400 response.

```http
PUT /projects/6c01/datasets/order/ HTTP/1.1
```

```json
{
  "element": "shoji:order",
  "self": "http:\/\/local.crunch.io:8080\/api\/projects\/6c01\/datasets\/order\/",
  "graph": [
    "https://beta.crunch.io/api/datasets/cc9161/",
    {
      "group": "https://beta.crunch.io/api/datasets/a598c7/"
    }
  ]
}
```

